#include <ESP8266WiFi.h>
#include <DNSServer.h>
#include <ESP8266WebServer.h>
#include <ESP8266HTTPUpdateServer.h>
#include <FS.h>   // Include the SPIFFS library

const byte DNS_PORT = 53;
IPAddress apIP(192, 168, 1, 1);
DNSServer dnsServer;
ESP8266WebServer webServer(80);
ESP8266HTTPUpdateServer httpUpdater;

// To upload through terminal you can use: curl -u admin:mysupersecurepassword -F "image=@firmware.bin" 192.168.1.1/firmware
// alternatively you can navigate to http://192.168.1.1/firmware

const char* update_path = "/firmware";
const char* update_username = "admin";
const char* update_password = "mysupersecurepassword";


String universal_preamble = "<!DOCTYPE html><html lang='en'><head><meta charset='UTF-8'>"
                            "<title>message box</title>"
                            "<meta name='viewport' content='width=device-width,initial-scale=1.0'><style>body {font-family: Avenir,Helvetica,sans-serif;padding:30px;margin: 20px auto; max-width: 500px;box-sizing: border-box};</style>" ;

String preamble = universal_preamble +
                  "<p style='font-style: italic;color: #555'>These messages are not stored on the internet, but on a small box that may move around the city, around the country, or around the world. Anyone in close proximity will be able to see the most recent message in their device's list of available wireless networks. Anyone can post a message up to 140 characters in length, that will be saved indefinitely, visible to those nearby. </p><br />\n\n";
String postamble = "\n\n"
                   "<form method='POST' action='/sign' style='display:flex;align-items: center' enctype='multipart/form-data'>"
                   "<input type='text' maxlength=140 name='message' style='flex:1;font: inherit; padding: 5px 10px; margin-right: 5px;' placeholder='Write a message here...'>"
                   "<input type='submit' value='Post' style='font:inherit'>"
                   "</form><br /><center style='opacity:0.8'>P.S. <a href='/wallsmash' style='color:#3d66a7'>Play Breakout for Free</a> <span id='winrar'></span> <!-- By Kevin Kwok <antimatter15@gmail.com>. WallSmash is by Guillermo Webster.  --></center>"
                   "<script>fetch('/scores').then(k => k.text()).then(text => {let scores = [];text.split('\\n').forEach(line => {try { scores.push(JSON.parse(line)) } catch (err) {} });scores.sort((b, a) => a.score - b.score).slice(0, 100);document.getElementById('winrar').innerText = '(Highscore: ' + scores[0].username + ' ' + scores[0].score + ')'})</script>";



String SSID_PREFIX = "\"";
String SSID_SUFFIX = "\"";


uint32_t currentTime = 0;
uint32_t packetRateTime = 0;

String test_ssid = SSID_PREFIX + "Please edit me!" + SSID_SUFFIX;
const bool wpa2 = true; // WPA2 networks


const int SSID_CONTENT_LEN = 32 - SSID_PREFIX.length() - SSID_SUFFIX.length();

void setSSID(String message) {
  message.trim();
  if (message.indexOf(";;") != -1) {
    message = message.substring(0, message.indexOf(";;"));
  }
  if (message.length() > SSID_CONTENT_LEN - 3) {
    message = message.substring(0, SSID_CONTENT_LEN - 3);
    message.trim();
    test_ssid = SSID_PREFIX + message + "..." + SSID_SUFFIX;
  } else {
    test_ssid = SSID_PREFIX + message + SSID_SUFFIX;
  }
}


static const char responseHTML[] PROGMEM = "<!doctype html><html lang=en><meta charset=UTF-8><meta content=\"width=device-width\"name=viewport><meta content=\"initial-scale=1\"name=viewport><title>WALLSMASH | The best game you've ever seen.</title><div class=game><div class=chrome><div id=header><div id=headerLeft><div id=title><svg height=49 version=1.1 viewBox=\"0 0 174 49\"width=174 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><g><path d=\"M 43.0129 5.1272C 43.0129 3.7002 42.9193 2.67145 42.7321 2.04092C 42.5449 1.3772 42.4513 0.912598 42.4513 0.647125C 42.4513 0.215698 42.6385 0 43.0129 0C 43.4497 0 43.9958 0.132751 44.651 0.398224C 45.3375 0.663727 45.9928 1.02875 46.6168 1.49335C 47.2409 1.92477 47.7713 2.43915 48.2081 3.0365C 48.6762 3.63382 48.9102 4.28094 48.9102 4.97784C 48.9102 7.03537 48.6918 9.24222 48.255 11.5984C 47.9142 13.5499 47.4413 15.5132 46.8363 17.4881C 47.2383 16.7744 47.6865 16.103 48.1808 15.4738C 49.1438 14.219 50.2236 13.2122 51.42 12.4535C 52.6165 11.6947 53.813 11.3154 55.0094 11.3154C 55.8849 11.3154 56.6291 11.4321 57.2419 11.6656C 57.8547 11.8698 58.3508 12.1033 58.7302 12.3659C 59.1679 12.6869 59.5181 13.0225 59.7807 13.3727C 60.1017 13.3727 60.4373 13.4165 60.7875 13.504C 61.1669 13.5624 61.5025 13.6791 61.7943 13.8542C 62.1153 14.0001 62.3779 14.2044 62.5822 14.467C 62.7865 14.7297 62.8886 15.0507 62.8886 15.4301C 62.8886 15.7511 62.7573 16.2763 62.4947 17.0059C 62.232 17.7354 61.9402 18.5526 61.6192 19.4572C 61.2982 20.3327 61.0064 21.2519 60.7437 22.2149C 60.4811 23.1487 60.3498 23.9804 60.3498 24.71C 60.3498 25.0602 60.4519 25.352 60.6562 25.5854C 60.8897 25.8189 61.1961 25.9356 61.5754 25.9356C 61.9166 25.9356 62.2528 25.8708 62.584 25.7412C 62.5828 25.6823 62.5822 25.6231 62.5822 25.5635C 62.5822 24.1044 62.7427 22.4848 63.0637 20.7047C 63.4139 18.9246 63.8954 17.1445 64.5082 15.3643C 65.1211 13.5551 65.8214 11.8041 66.6094 10.1116C 67.4265 8.41901 68.3165 6.91611 69.2795 5.60291C 70.2425 4.26053 71.2347 3.19537 72.2561 2.40747C 73.3067 1.61954 74.3572 1.22559 75.4078 1.22559C 75.9039 1.22559 76.3708 1.34232 76.8085 1.57578C 77.2463 1.80923 77.6256 2.10104 77.9466 2.45123C 78.2968 2.80142 78.5741 3.19537 78.7783 3.63312C 78.9826 4.04166 79.0847 4.43564 79.0847 4.815C 79.0847 5.42783 78.9097 6.21573 78.5595 7.17874C 78.2385 8.11258 77.8007 9.13397 77.2463 10.2429C 76.6918 11.3226 76.0352 12.4461 75.2765 13.6134C 74.5469 14.7807 73.7736 15.9188 72.9565 17.0277C 72.1686 18.1075 71.3661 19.1288 70.549 20.0919C 69.7319 21.0257 68.9585 21.799 68.229 22.4119C 68.1706 22.7621 68.1122 23.1268 68.0539 23.5062C 67.9955 23.8272 67.9517 24.192 67.9226 24.6005C 67.8934 24.9799 67.8788 25.3593 67.8788 25.7386C 67.8788 26.76 68.1122 27.5917 68.5792 28.2337C 69.0753 28.8757 69.7756 29.1967 70.6803 29.1967C 70.7727 29.1967 70.8647 29.192 70.9563 29.1825C 71.0337 28.2372 71.1679 27.2352 71.3588 26.1764C 71.709 24.3963 72.1905 22.6162 72.8033 20.8361C 73.4161 19.0268 74.1165 17.2758 74.9044 15.5833C 75.7215 13.8907 76.6116 12.3878 77.5746 11.0746C 78.5376 9.73224 79.5298 8.66708 80.5512 7.87918C 81.6017 7.09125 82.6523 6.6973 83.7029 6.6973C 84.199 6.6973 84.6659 6.81403 85.1036 7.04749C 85.5413 7.28094 85.9207 7.57275 86.2417 7.92294C 86.5919 8.27313 86.8691 8.66708 87.0734 9.10483C 87.2777 9.51337 87.3798 9.90735 87.3798 10.2867C 87.3798 10.8995 87.2047 11.6874 86.8545 12.6505C 86.5335 13.5843 86.0958 14.6057 85.5413 15.7146C 84.9869 16.7943 84.3303 17.9178 83.5715 19.0851C 82.842 20.2524 82.0687 21.3905 81.2516 22.4995C 80.4636 23.5792 79.6611 24.6006 78.844 25.5636C 78.0269 26.4974 77.2536 27.2708 76.524 27.8836C 76.4657 28.2338 76.4073 28.5985 76.3489 28.9779C 76.2906 29.2989 76.2468 29.6637 76.2176 30.0722C 76.1884 30.4516 76.1739 30.831 76.1739 31.2103C 76.1739 32.2317 76.4073 33.0634 76.8742 33.7054C 77.3703 34.3474 78.0707 34.6684 78.9753 34.6684C 83.0312 34.6684 87.2755 27.3662 86.8545 25.5636C 85.5795 20.1033 89.2276 20.8289 90.5649 23.2694C 93.0933 27.8836 83.5715 37.6012 77.5308 37.6012C 76.6554 37.6012 75.8091 37.4553 74.992 37.1635C 74.2041 36.8717 73.5037 36.4485 72.8909 35.8941C 72.278 35.3104 71.7819 34.6101 71.4026 33.793C 71.1522 33.2087 70.9913 32.5722 70.9199 31.8835C 70.3844 32.0475 69.823 32.1295 69.2358 32.1295C 68.3603 32.1295 67.514 31.9836 66.6969 31.6918C 65.909 31.4 65.2086 30.9768 64.5958 30.4224C 63.983 29.8387 63.4869 29.1384 63.1075 28.3213C 63.0752 28.2458 63.0443 28.1695 63.015 28.0923C 62.1353 28.6097 61.174 28.8685 60.1309 28.8685C 58.9053 28.8685 57.8693 28.562 57.023 27.9492C 56.1767 27.3072 55.6806 26.3734 55.5347 25.1477C 54.9511 25.8773 54.3237 26.5047 53.6525 27.03C 53.0688 27.4969 52.4122 27.92 51.6827 28.2994C 50.9531 28.6788 50.1652 28.8685 49.3189 28.8685C 48.7353 28.8685 48.1662 28.7517 47.6118 28.5183C 47.0865 28.314 46.6196 28.0076 46.211 27.599C 45.8316 27.1905 45.5252 26.709 45.2918 26.1545C 45.0583 25.6 44.9416 24.9872 44.9416 24.316C 44.9416 23.6296 44.997 22.9459 45.1077 22.265C 44.674 23.3071 44.2098 24.3312 43.715 25.3372C 42.6541 27.4943 41.484 29.4025 40.2047 31.0618C 38.9566 32.7211 37.5992 34.0485 36.1327 35.0441C 34.6974 36.0396 33.2309 36.5374 31.7331 36.5374C 30.4226 36.5374 29.3773 36.2553 28.5973 35.6912C 27.8484 35.0938 27.2555 34.4301 26.8187 33.7C 26.3195 32.8372 25.9762 31.8748 25.789 30.8129C 24.8529 31.8748 23.8701 32.8372 22.8404 33.7C 21.9355 34.4301 20.9214 35.0938 19.7981 35.6912C 18.6748 36.2553 17.5047 36.5374 16.2878 36.5374C 15.5389 36.5374 14.8213 36.4047 14.1348 36.1392C 13.4484 35.9069 12.8243 35.5584 12.2627 35.0938C 11.7322 34.6292 11.311 34.0651 10.9989 33.4014C 10.6869 32.7376 10.5309 31.9744 10.5309 31.1116C 10.5309 29.9501 10.7337 28.6724 11.1394 27.2786C 11.5762 25.8848 12.1066 24.4247 12.7307 22.8981C 13.386 21.3716 14.088 19.8284 14.8369 18.2687C 15.5857 16.6758 16.2722 15.1161 16.8963 13.5895C 17.5515 12.0298 18.082 10.553 18.4876 9.15924C 18.9244 7.73227 19.1428 6.42142 19.1428 5.22675C 19.1428 4.62939 18.9868 4.11502 18.6748 3.68359C 18.3628 3.21899 17.8479 2.98669 17.1303 2.98669C 16.1942 2.98669 15.1021 3.40152 13.854 4.23117C 12.6371 5.02762 11.4826 6.03979 10.3905 7.26767C 9.32961 8.49554 8.42473 9.82297 7.67586 11.2499C 6.92699 12.6769 6.55257 13.9878 6.55257 15.1824C 6.55257 16.1448 6.66177 16.9413 6.8802 17.5718C 7.12981 18.2023 7.39503 18.7333 7.67586 19.1647C 7.98788 19.5961 8.25311 19.928 8.47153 20.1603C 8.72115 20.3926 8.84596 20.5917 8.84596 20.7576C 8.84596 21.3882 8.51833 21.7034 7.86308 21.7034C 7.23902 21.7034 6.47456 21.5043 5.56968 21.1061C 4.69601 20.7079 3.83793 20.1769 2.99546 19.5132C 2.18419 18.8495 1.48212 18.0696 0.889275 17.1736C 0.296425 16.2776 0 15.3318 0 14.3362C 0 13.1747 0.296425 12.0132 0.889275 10.8517C 1.48212 9.65701 2.27779 8.52872 3.27628 7.46677C 4.27477 6.40485 5.41367 5.42584 6.69298 4.52985C 7.97228 3.60065 9.2984 2.8042 10.6713 2.14047C 12.0442 1.47678 13.4016 0.962372 14.7433 0.597351C 16.1162 0.199127 17.3643 0 18.4876 0C 20.391 0 21.9199 0.514374 23.0744 1.54312C 24.2601 2.5387 24.8529 4.06525 24.8529 6.12274C 24.8529 7.15152 24.6501 8.32959 24.2445 9.65701C 23.8701 10.9513 23.3864 12.3451 22.7936 13.8384C 22.2007 15.2986 21.5611 16.8085 20.8746 18.3683C 20.1881 19.8948 19.5485 21.3882 18.9556 22.8483C 18.3628 24.2753 17.8635 25.6193 17.4579 26.8804C 17.0835 28.1414 16.8963 29.2366 16.8963 30.1658C 16.8963 30.8295 17.0835 31.3604 17.4579 31.7587C 17.8323 32.1237 18.316 32.3062 18.9088 32.3062C 19.5017 32.3062 20.1725 32.0242 20.9214 31.46C 21.6703 30.8958 22.3723 30.2653 23.0276 29.5684C 23.8076 28.772 24.5877 27.8594 25.3678 26.8306C 25.6798 23.9103 26.1635 21.2886 26.8187 18.9656C 27.0995 17.97 27.4116 17.0077 27.7548 16.0785C 28.1292 15.1493 28.5661 14.3196 29.0653 13.5895C 29.5645 12.8263 30.1262 12.2289 30.7502 11.7975C 31.3743 11.3329 32.0608 11.1006 32.8096 11.1006C 33.5897 11.1006 34.2137 11.3661 34.6818 11.8971C 35.181 12.3948 35.4306 13.0254 35.4306 13.7886C 35.4306 14.386 35.337 15.0497 35.1498 15.7798C 34.9626 16.5099 34.713 17.2731 34.401 18.0696C 34.0889 18.8329 33.7301 19.6127 33.3245 20.4092C 32.95 21.1725 32.56 21.9191 32.1544 22.6492C 31.1871 24.3749 30.095 26.1171 28.8781 27.8759C 29.0029 28.7056 29.1901 29.4357 29.4397 30.0662C 29.6582 30.6304 29.939 31.1281 30.2822 31.5596C 30.6254 31.991 31.0779 32.2067 31.6395 32.2067C 32.638 32.2067 33.6209 31.7919 34.5882 30.9622C 35.5555 30.0994 36.4603 28.9711 37.3028 27.5773C 38.1453 26.1835 38.9097 24.5574 39.5962 22.699C 40.3139 20.8406 40.9223 18.9158 41.4216 16.9247C 41.9208 14.9335 42.3108 12.9258 42.5917 10.9015C 42.8725 8.84396 43.0129 6.91922 43.0129 5.1272ZM 56.0289 42.8221C 48.8665 41.6664 47.8525 36.8021 54.3382 35.8233C 57.3086 35.3751 61.5654 35.8233 63.5084 36.4283C 67.645 37.7164 69.5602 37.7943 70.1772 37.3063C 70.8641 36.7629 69.9417 35.5179 68.6839 34.4601C 64.6508 31.0681 43.2623 28.7151 41.2999 35.8233C 40.1406 40.0225 45.6237 48.2718 62.8918 48.2718C 74.996 48.2718 100.748 38.3386 100.748 22.981C 100.748 20.0117 99.1394 17.601 97.5361 15.1988C 95.944 12.8134 94.3575 10.4363 94.3575 7.52899C 94.3575 4.74078 96.9252 2.58261 99.6102 2.58261C 103.206 2.58261 101.19 6.77054 99.9167 8.31693L 99.8662 8.37967C 99.5305 8.79654 99.0965 9.33527 99.5665 9.80521C 100.099 10.3377 101.058 9.81253 101.615 9.50735C 101.649 9.48901 101.681 9.47147 101.711 9.45502C 103.783 8.33313 106.264 6.10141 106.264 3.58942C 106.264 0.685791 102.397 0 100.179 0C 95.2273 0 88.7545 3.00714 88.7545 8.66711C 88.7545 11.4932 90.3448 13.7762 91.9236 16.0428C 93.5544 18.384 95.1729 20.7076 95.014 23.5938C 94.3664 35.363 72.1971 45.4309 56.0289 42.8221ZM 57.023 14.3357C 57.344 14.6275 57.5045 15.0945 57.5045 15.7365C 57.5045 16.5828 57.2857 17.575 56.8479 18.713C 56.4394 19.822 55.9287 20.8871 55.3159 21.9085C 54.703 22.9299 54.0464 23.7908 53.3461 24.4911C 52.6749 25.1915 52.0766 25.5417 51.5514 25.5417C 50.7051 25.5417 50.2819 24.8851 50.2819 23.5719C 50.2819 22.6672 50.457 21.6459 50.8072 20.5078C 51.1574 19.3697 51.5951 18.3191 52.1204 17.3561C 52.6749 16.3639 53.2877 15.5322 53.9589 14.861C 54.6301 14.1898 55.2867 13.8542 55.9287 13.8542C 56.3664 13.8542 56.7312 14.0147 57.023 14.3357ZM 138.681 32.0284C 137.568 32.0284 136.628 31.7372 135.86 31.1546C 135.092 30.5444 134.641 29.6568 134.509 28.4918C 133.979 29.1852 133.41 29.7816 132.8 30.2809C 132.271 30.7247 131.675 31.1269 131.013 31.4875C 130.35 31.8481 129.635 32.0284 128.867 32.0284C 128.337 32.0284 127.821 31.9174 127.318 31.6955C 126.841 31.5014 126.417 31.2101 126.046 30.8218C 125.702 30.4335 125.424 29.9758 125.212 29.4488C 125.089 29.1428 125.002 28.8182 124.95 28.4748C 124.717 28.7733 124.483 29.075 124.253 29.3862C 122.611 31.6047 120.558 32.3136 118.746 30.5425C 117.048 28.8815 117.739 26.7496 118.461 24.5269L 118.52 24.3441C 118.672 23.8751 118.825 23.4407 118.965 23.0415L 118.965 23.0411L 118.966 23.0405C 119.51 21.4929 119.868 20.4759 119.257 20.0284C 117.756 18.9298 116.24 21.1195 115.423 22.3002C 115.349 22.4064 115.281 22.5044 115.219 22.5912C 115.1 22.9554 114.844 24.0307 114.539 25.3069C 113.962 27.7262 113.213 30.8674 112.9 31.2539C 112.265 32.0383 108.997 30.5805 109.539 28.8327C 109.588 28.6758 109.651 28.4782 109.724 28.2479L 109.725 28.2458L 109.726 28.2423C 110.47 25.9044 112.274 20.2308 111.246 19.7577C 110.115 19.2376 107.742 21.1021 107.015 22.5912C 107.015 24.9449 106.005 29.4893 105.264 31.2539C 104.802 32.3521 101.24 30.3113 101.752 28.836C 103.49 23.8185 103.664 19.9088 101.151 16.6333C 99.5544 14.5522 104.522 15.3186 105.369 16.6333C 105.812 17.3206 106.329 18.6374 106.522 19.7577C 107.935 17.5922 109.473 16.1298 111.739 15.6606C 113.522 15.2916 115.337 16.6677 115.622 18.5603C 116.975 16.6333 119.19 15.5752 120.807 16.0099C 123.06 16.6158 123.836 18.5039 123.452 20.9868C 123.214 22.5177 122.589 24.0606 122.058 25.3709C 121.316 27.1999 120.758 28.5756 121.697 28.8327C 122.625 29.0869 123.784 28.1268 124.968 26.3361C 125.08 25.3005 125.32 24.2715 125.689 23.2493C 126.245 21.7792 126.96 20.4617 127.834 19.2967C 128.708 18.1039 129.688 17.147 130.774 16.4258C 131.86 15.7046 132.946 15.344 134.032 15.344C 134.827 15.344 135.502 15.455 136.058 15.6769C 136.615 15.871 137.065 16.093 137.409 16.3426C 137.806 16.6477 138.124 16.9667 138.363 17.2996C 139.516 16.3426 140.603 15.8428 142.152 16.3426C 143.003 16.6171 143.287 20.1365 141.615 20.5202C 138.602 21.2116 137.409 24.4077 137.409 26.5363C 137.409 28.6649 138.595 29.1256 139.263 29.1256C 139.817 29.1256 140.289 28.8423 140.702 28.4053C 140.679 28.3667 140.657 28.328 140.635 28.2891C 140.237 27.6344 140.039 27.0301 140.039 26.4761C 140.039 25.9221 140.237 25.4563 140.635 25.0786C 141.032 24.7009 141.469 24.3861 141.946 24.1343C 142.502 23.8573 143.138 23.6307 143.853 23.4544C 144.012 23.2026 144.224 22.8879 144.489 22.5102C 144.7 22.1828 144.979 21.78 145.323 21.3015C 145.667 20.7979 146.064 20.2062 146.515 19.5263C 147.351 18.3222 150.467 15.344 152.276 15.344C 152.913 15.344 153.689 15.8871 154.024 16.3638C 154.28 16.6567 154.237 16.9034 154.063 17.2325C 153.928 17.4574 153.59 17.6595 153.195 17.8952C 152.508 18.3058 151.65 18.8182 151.399 19.7301C 151.112 20.7755 151.545 21.6373 151.966 22.4774C 152.123 22.7907 152.279 23.101 152.395 23.4167C 152.819 24.3755 153.189 25.3481 153.189 26.4005C 153.189 26.9041 153.136 27.3322 153.031 27.6848C 152.951 28.0121 152.845 28.3017 152.713 28.5535C 152.58 28.8304 152.435 29.0697 152.276 29.2711C 153.088 29.0582 153.796 28.5392 154.422 27.8981C 154.495 22.7383 154.925 17.5767 156.64 12.8212C 158.11 8.74393 162.431 1.24728 167.322 1.24728C 168.976 1.24728 170.897 3.23663 170.897 5.09933C 170.897 8.90555 167.944 13.0806 165.573 15.6925C 165.6 15.6633 165.706 15.5903 165.891 15.4736C 166.103 15.3569 166.355 15.2401 166.646 15.1234C 166.938 14.9775 167.269 14.8608 167.639 14.7732C 168.037 14.6565 168.447 14.5981 168.871 14.5981C 169.162 14.5981 169.454 14.6857 169.745 14.8608C 170.063 15.0359 170.341 15.2693 170.579 15.5612C 170.818 15.853 171.017 16.174 171.175 16.5242C 171.334 16.8744 171.414 17.2391 171.414 17.6185C 171.414 18.9803 170.374 20.8406 169.336 22.698C 167.962 25.1572 166.591 27.6111 167.639 28.8952C 169.305 30.9342 171.592 28.6887 171.963 26.5971C 171.977 26.5168 171.99 26.4374 172.002 26.3599C 172.088 25.8199 172.159 25.3714 172.658 25.3714C 173.393 25.3714 173.569 25.8916 173.327 27.555C 172.844 30.8818 167.639 34.9723 163.841 30.8818C 161.821 28.7062 163.256 25.7402 164.527 23.1132C 164.911 22.3201 165.28 21.558 165.534 20.8577C 165.746 20.2741 165.852 19.778 165.852 19.3694C 165.852 18.5231 165.56 18.1 164.978 18.1C 164.289 18.1 163.587 18.421 162.872 19.063C 162.157 19.6758 161.508 20.5659 160.925 21.7332C 160.369 22.8713 159.905 24.2574 159.534 25.8916C 159.19 27.4967 159.018 29.2914 159.018 31.2758C 159.018 31.5384 158.965 31.7427 158.859 31.8886C 158.78 32.0637 158.594 32.1512 158.303 32.1512C 157.906 32.1512 157.482 32.1075 157.031 32.0199C 156.581 31.9324 156.157 31.801 155.76 31.6259C 155.363 31.4217 155.045 31.1736 154.807 30.8818C 154.619 30.6551 154.498 30.4065 154.444 30.136C 153.795 30.6272 153.106 31.0224 152.395 31.2729C 150.991 31.7766 149.269 32.0284 147.23 32.0284C 146.25 32.0284 145.323 31.8395 144.449 31.4618C 143.575 31.1093 142.807 30.656 142.144 30.1021C 142.099 30.0622 142.054 30.0222 142.009 29.9818C 141.134 31.1797 140.039 32.0284 138.681 32.0284ZM 136.297 19.5463C 136.297 18.9361 136.151 18.4923 135.86 18.2149C 135.595 17.9098 135.264 17.7572 134.866 17.7572C 134.284 17.7572 133.688 18.0762 133.079 18.7142C 132.469 19.3521 131.913 20.1427 131.41 21.0858C 130.933 22.0011 130.536 22.9997 130.218 24.0815C 129.9 25.1632 129.741 26.1341 129.741 26.994C 129.741 28.2422 130.125 28.8663 130.893 28.8663C 131.37 28.8663 131.913 28.5334 132.522 27.8677C 133.158 27.202 133.754 26.3837 134.31 25.4129C 134.866 24.4421 135.33 23.4296 135.701 22.3756C 136.098 21.2938 136.297 20.3507 136.297 19.5463ZM 76.3708 4.15839C 76.721 4.15839 76.8961 4.36267 76.8961 4.77121C 76.8961 5.20895 76.7648 5.82178 76.5021 6.60971C 76.2395 7.39761 75.8893 8.27307 75.4516 9.23608C 75.043 10.1699 74.5615 11.1475 74.007 12.1689C 73.4526 13.1903 72.8835 14.1825 72.2999 15.1455C 71.7162 16.0793 71.118 16.9256 70.5052 17.6843C 69.9215 18.4431 69.3817 19.0267 68.8856 19.4353C 69.3233 17.5968 69.8924 15.7729 70.5927 13.9636C 71.2931 12.1543 71.9935 10.5201 72.6938 9.061C 73.4234 7.6019 74.1092 6.42001 74.7512 5.51538C 75.4224 4.61072 75.9622 4.15839 76.3708 4.15839ZM 85.1912 10.2429C 85.1912 9.83438 85.0161 9.6301 84.6659 9.6301C 84.2573 9.6301 83.7175 10.0824 83.0463 10.9871C 82.4043 11.8917 81.7185 13.0736 80.9889 14.5327C 80.2885 15.9918 79.5882 17.626 78.8878 19.4353C 78.1874 21.2446 77.6184 23.0685 77.1806 24.907C 77.6767 24.4984 78.2166 23.9148 78.8003 23.156C 79.4131 22.3973 80.0113 21.551 80.595 20.6172C 81.1786 19.6542 81.7477 18.662 82.3021 17.6406C 82.8566 16.6192 83.3381 15.6416 83.7466 14.7078C 84.1844 13.7448 84.5346 12.8693 84.7972 12.0814C 85.0598 11.2935 85.1912 10.6807 85.1912 10.2429ZM 147.27 21.3015C 146.713 22.1073 146.223 22.8375 145.8 23.4922C 145.429 24.0714 145.084 24.6127 144.767 25.1164C 144.475 25.62 144.33 25.9347 144.33 26.0606C 144.33 26.6146 144.356 27.1559 144.409 27.6848C 144.489 28.1884 144.608 28.6416 144.767 29.0445C 144.926 29.4474 145.124 29.7747 145.363 30.0265C 145.601 30.2531 145.906 30.3665 146.276 30.3665C 146.886 30.3665 147.402 30.0517 147.826 29.4222C 148.276 28.7927 148.501 28.0499 148.501 27.1937C 148.501 26.7153 148.435 26.2117 148.303 25.6829C 148.17 25.1541 148.025 24.6379 147.866 24.1343C 147.733 23.6055 147.601 23.1019 147.468 22.6235C 147.336 22.1199 147.27 21.6792 147.27 21.3015ZM 159.534 19.7698C 159.534 16.9245 161.567 6.73575 168.196 4.18008C 170.007 3.48172 168.704 8.09341 168.196 9.05573C 166.635 12.01 164.977 13.5313 163.427 14.9527C 161.978 16.2821 160.624 17.5242 159.534 19.7698Z\"fill-rule=evenodd id=path0_fill /></g></svg></div></div><div id=scoreboardButton>Scoreboard</div></div><div id=scoreInfo><div id=score-wrap>Score: <span id=score>0</span></div><div>Record: <span id=record>0</span></div><div class=spacer></div><div id=end_button class=button>End Turn</div></div></div><div id=canvas-wrap><canvas id=canvas tabindex=1></canvas></div></div><script>!function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p=\"\",t(0)}([function(e,t,n){e.exports=n(6)},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push(\"@media \"+n[2]+\"{\"+n[1]+\"}\"):e.push(n[1])}return e.join(\"\")},e.i=function(t,n){\"string\"==typeof t&&(t=[[null,t,\"\"]]);for(var a={},r=0;r<this.length;r++){var o=this[r][0];\"number\"==typeof o&&(a[o]=!0)}for(r=0;r<t.length;r++){var i=t[r];\"number\"==typeof i[0]&&a[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]=\"(\"+i[2]+\") and (\"+n+\")\"),e.push(i))}},e}},function(e,t,n){function a(e,t){for(var n=0;n<e.length;n++){var a=e[n],r=p[a.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](a.parts[o]);for(;o<a.parts.length;o++)r.parts.push(c(a.parts[o],t))}else{for(var i=[],o=0;o<a.parts.length;o++)i.push(c(a.parts[o],t));p[a.id]={id:a.id,refs:1,parts:i}}}}function r(e){for(var t=[],n={},a=0;a<e.length;a++){var r=e[a],o=r[0],i=r[1],s=r[2],l=r[3],c={css:i,media:s,sourceMap:l};n[o]?n[o].parts.push(c):t.push(n[o]={id:o,parts:[c]})}return t}function o(e,t){var n=w(),a=b[b.length-1];if(\"top\"===e.insertAt)a?a.nextSibling?n.insertBefore(t,a.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),b.push(t);else{if(\"bottom\"!==e.insertAt)throw new Error(\"Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.\");n.appendChild(t)}}function i(e){e.parentNode.removeChild(e);var t=b.indexOf(e);t>=0&&b.splice(t,1)}function s(e){var t=document.createElement(\"style\");return t.type=\"text/css\",o(e,t),t}function l(e){var t=document.createElement(\"link\");return t.rel=\"stylesheet\",o(e,t),t}function c(e,t){var n,a,r;if(t.singleton){var o=v++;n=g||(g=s(t)),a=d.bind(null,n,o,!1),r=d.bind(null,n,o,!0)}else e.sourceMap&&\"function\"==typeof URL&&\"function\"==typeof URL.createObjectURL&&\"function\"==typeof URL.revokeObjectURL&&\"function\"==typeof Blob&&\"function\"==typeof btoa?(n=l(t),a=f.bind(null,n),r=function(){i(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),a=u.bind(null,n),r=function(){i(n)});return a(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a(e=t)}else r()}}function d(e,t,n,a){var r=n?\"\":a.css;if(e.styleSheet)e.styleSheet.cssText=x(t,r);else{var o=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function u(e,t){var n=t.css,a=t.media;if(a&&e.setAttribute(\"media\",a),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function f(e,t){var n=t.css,a=t.sourceMap;a&&(n+=\"\\n/*# sourceMappingURL=data:application/json;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+\" */\");var r=new Blob([n],{type:\"text/css\"}),o=e.href;e.href=URL.createObjectURL(r),o&&URL.revokeObjectURL(o)}var p={},h=function(e){var t;return function(){return\"undefined\"==typeof t&&(t=e.apply(this,arguments)),t}},m=h(function(){return/msie [6-9]\\b/.test(self.navigator.userAgent.toLowerCase())}),w=h(function(){return document.head||document.getElementsByTagName(\"head\")[0]}),g=null,v=0,b=[];e.exports=function(e,t){t=t||{},\"undefined\"==typeof t.singleton&&(t.singleton=m()),\"undefined\"==typeof t.insertAt&&(t.insertAt=\"bottom\");var n=r(e);return a(n,t),function(e){for(var o=[],i=0;i<n.length;i++){var s=n[i],l=p[s.id];l.refs--,o.push(l)}if(e){var c=r(e);a(c,t)}for(var i=0;i<o.length;i++){var l=o[i];if(0===l.refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete p[l.id]}}}};var x=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join(\"\\n\")}}()},function(e,t,n){!function(t,n){e.exports=n()}(this,function(){\"use strict\";var e={title:\"\",titleText:\"\",text:\"\",html:\"\",type:null,customClass:\"\",target:\"body\",animation:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,showConfirmButton:!0,showCancelButton:!1,preConfirm:null,confirmButtonText:\"OK\",confirmButtonColor:\"#3085d6\",confirmButtonClass:null,cancelButtonText:\"Cancel\",cancelButtonColor:\"#aaa\",cancelButtonClass:null,buttonsStyling:!0,reverseButtons:!1,focusCancel:!1,showCloseButton:!1,showLoaderOnConfirm:!1,imageUrl:null,imageWidth:null,imageHeight:null,imageClass:null,timer:null,width:500,padding:20,background:\"#fff\",input:null,inputPlaceholder:\"\",inputValue:\"\",inputOptions:{},inputAutoTrim:!0,inputClass:null,inputAttributes:{},inputValidator:null,progressSteps:[],currentProgressStep:null,progressStepsDistance:\"40px\",onOpen:null,onClose:null,useRejections:!0},t=\"swal2-\",n=function(e){var n={};for(var a in e)n[e[a]]=t+e[a];return n},a=n([\"container\",\"shown\",\"iosfix\",\"modal\",\"overlay\",\"fade\",\"show\",\"hide\",\"noanimation\",\"close\",\"title\",\"content\",\"buttonswrapper\",\"confirm\",\"cancel\",\"icon\",\"image\",\"input\",\"file\",\"range\",\"select\",\"radio\",\"checkbox\",\"textarea\",\"inputerror\",\"validationerror\",\"progresssteps\",\"activeprogressstep\",\"progresscircle\",\"progressline\",\"loading\",\"styled\"]),r=n([\"success\",\"warning\",\"info\",\"question\",\"error\"]),o=function(e,t){e=String(e).replace(/[^0-9a-f]/gi,\"\"),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;for(var n=\"#\",a=0;a<3;a++){var r=parseInt(e.substr(2*a,2),16);r=Math.round(Math.min(Math.max(0,r+r*t),255)).toString(16),n+=(\"00\"+r).substr(r.length)}return n},i=function(e){var t=[];for(var n in e)t.indexOf(e[n])===-1&&t.push(e[n]);return t},s={previousWindowKeyDown:null,previousActiveElement:null,previousBodyPadding:null},l=function(e){if(\"undefined\"==typeof document)return void console.error(\"SweetAlert2 requires document to initialize\");var t=document.createElement(\"div\");t.className=a.container,t.innerHTML=c;var n=document.querySelector(e.target);n||(console.warn(\"SweetAlert2: Can't find the target \\\"\"+e.target+'\"'),n=document.body),n.appendChild(t);var r=u(),o=P(r,a.input),i=P(r,a.file),s=r.querySelector(\".\"+a.range+\" input\"),l=r.querySelector(\".\"+a.range+\" output\"),d=P(r,a.select),f=r.querySelector(\".\"+a.checkbox+\" input\"),p=P(r,a.textarea);return o.oninput=function(){Z.resetValidationError()},o.onkeydown=function(t){setTimeout(function(){13===t.keyCode&&e.allowEnterKey&&(t.stopPropagation(),Z.clickConfirm())},0)},i.onchange=function(){Z.resetValidationError()},s.oninput=function(){Z.resetValidationError(),l.value=s.value},s.onchange=function(){Z.resetValidationError(),s.previousSibling.value=s.value},d.onchange=function(){Z.resetValidationError()},f.onchange=function(){Z.resetValidationError()},p.oninput=function(){Z.resetValidationError()},r},c=('\\n <div role=\"dialog\" aria-labelledby=\"'+a.title+'\" aria-describedby=\"'+a.content+'\" class=\"'+a.modal+'\" tabindex=\"-1\">\\n   <ul class=\"'+a.progresssteps+'\"></ul>\\n   <div class=\"'+a.icon+\" \"+r.error+'\">\\n     <span class=\"swal2-x-mark\"><span class=\"swal2-x-mark-line-left\"></span><span class=\"swal2-x-mark-line-right\"></span></span>\\n   </div>\\n   <div class=\"'+a.icon+\" \"+r.question+'\">?</div>\\n   <div class=\"'+a.icon+\" \"+r.warning+'\">!</div>\\n   <div class=\"'+a.icon+\" \"+r.info+'\">i</div>\\n   <div class=\"'+a.icon+\" \"+r.success+'\">\\n     <div class=\"swal2-success-circular-line-left\"></div>\\n     <span class=\"swal2-success-line-tip\"></span> <span class=\"swal2-success-line-long\"></span>\\n     <div class=\"swal2-success-ring\"></div> <div class=\"swal2-success-fix\"></div>\\n     <div class=\"swal2-success-circular-line-right\"></div>\\n   </div>\\n   <img class=\"'+a.image+'\" />\\n   <h2 class=\"'+a.title+'\" id=\"'+a.title+'\"></h2>\\n   <div id=\"'+a.content+'\" class=\"'+a.content+'\"></div>\\n   <input class=\"'+a.input+'\" />\\n   <input type=\"file\" class=\"'+a.file+'\" />\\n   <div class=\"'+a.range+'\">\\n     <output></output>\\n     <input type=\"range\" />\\n   </div>\\n   <select class=\"'+a.select+'\"></select>\\n   <div class=\"'+a.radio+'\"></div>\\n   <label for=\"'+a.checkbox+'\" class=\"'+a.checkbox+'\">\\n     <input type=\"checkbox\" />\\n   </label>\\n   <textarea class=\"'+a.textarea+'\"></textarea>\\n   <div class=\"'+a.validationerror+'\"></div>\\n   <div class=\"'+a.buttonswrapper+'\">\\n     <button type=\"button\" class=\"'+a.confirm+'\">OK</button>\\n     <button type=\"button\" class=\"'+a.cancel+'\">Cancel</button>\\n   </div>\\n   <button type=\"button\" class=\"'+a.close+'\" aria-label=\"Close this dialog\">×</button>\\n </div>\\n').replace(/(^|\\n)\\s*/g,\"\"),d=function(){return document.body.querySelector(\".\"+a.container)},u=function(){return d()?d().querySelector(\".\"+a.modal):null},f=function(){var e=u();return e.querySelectorAll(\".\"+a.icon)},p=function(e){return d()?d().querySelector(\".\"+e):null},h=function(){return p(a.title)},m=function(){return p(a.content)},w=function(){return p(a.image)},g=function(){return p(a.buttonswrapper)},v=function(){return p(a.progresssteps)},b=function(){return p(a.validationerror)},x=function(){return p(a.confirm)},y=function(){return p(a.cancel)},k=function(){return p(a.close)},S=function(e){var t=[x(),y()];e&&t.reverse();var n=t.concat(Array.prototype.slice.call(u().querySelectorAll('button, input:not([type=hidden]), textarea, select, a, *[tabindex]:not([tabindex=\"-1\"])')));return i(n)},M=function(e,t){return!!e.classList&&e.classList.contains(t)},C=function(e){if(e.focus(),\"file\"!==e.type){var t=e.value;e.value=\"\",e.value=t}},E=function(e,t){if(e&&t){var n=t.split(/\\s+/).filter(Boolean);n.forEach(function(t){e.classList.add(t)})}},A=function(e,t){if(e&&t){var n=t.split(/\\s+/).filter(Boolean);n.forEach(function(t){e.classList.remove(t)})}},P=function(e,t){for(var n=0;n<e.childNodes.length;n++)if(M(e.childNodes[n],t))return e.childNodes[n]},B=function(e,t){t||(t=\"block\"),e.style.opacity=\"\",e.style.display=t},L=function(e){e.style.opacity=\"\",e.style.display=\"none\"},T=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},O=function(e){return e.offsetWidth||e.offsetHeight||e.getClientRects().length},q=function(e,t){e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(t)},R=function(e){if(!O(e))return!1;if(\"function\"==typeof MouseEvent){var t=new MouseEvent(\"click\",{view:window,bubbles:!1,cancelable:!0});e.dispatchEvent(t)}else if(document.createEvent){var n=document.createEvent(\"MouseEvents\");n.initEvent(\"click\",!1,!1),e.dispatchEvent(n)}else document.createEventObject?e.fireEvent(\"onclick\"):\"function\"==typeof e.onclick&&e.onclick()},I=function(){var e=document.createElement(\"div\"),t={WebkitAnimation:\"webkitAnimationEnd\",OAnimation:\"oAnimationEnd oanimationend\",msAnimation:\"MSAnimationEnd\",animation:\"animationend\"};for(var n in t)if(t.hasOwnProperty(n)&&void 0!==e.style[n])return t[n];return!1}(),H=function(){if(window.onkeydown=s.previousWindowKeyDown,s.previousActiveElement&&s.previousActiveElement.focus){var e=window.scrollX,t=window.scrollY;s.previousActiveElement.focus(),e&&t&&window.scrollTo(e,t)}},z=function(){var e=\"ontouchstart\"in window||navigator.msMaxTouchPoints;if(e)return 0;var t=document.createElement(\"div\");t.style.width=\"50px\",t.style.height=\"50px\",t.style.overflow=\"scroll\",document.body.appendChild(t);var n=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),n},N=function(e,t){var n=void 0;return function(){var a=function(){n=null,e()};clearTimeout(n),n=setTimeout(a,t)}},j=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},U=V({},e),D=[],X=void 0,W=function(t){var n=u()||l(t);for(var o in t)e.hasOwnProperty(o)||\"extraParams\"===o||console.warn('SweetAlert2: Unknown parameter \"'+o+'\"');n.style.width=\"number\"==typeof t.width?t.width+\"px\":t.width,n.style.padding=t.padding+\"px\",n.style.background=t.background;for(var i=n.querySelectorAll(\"[class^=swal2-success-circular-line], .swal2-success-fix\"),s=0;s<i.length;s++)i[s].style.background=t.background;var c=h(),d=m(),p=g(),b=x(),S=y(),M=k();if(t.titleText?c.innerText=t.titleText:c.innerHTML=t.title.split(\"\\n\").join(\"<br />\"),t.text||t.html){if(\"object\"===j(t.html))if(d.innerHTML=\"\",0 in t.html)for(var C=0;C in t.html;C++)d.appendChild(t.html[C].cloneNode(!0));else d.appendChild(t.html.cloneNode(!0));else t.html?d.innerHTML=t.html:t.text&&(d.textContent=t.text);B(d)}else L(d);t.showCloseButton?B(M):L(M),n.className=a.modal,t.customClass&&E(n,t.customClass);var P=v(),O=parseInt(null===t.currentProgressStep?Z.getQueueStep():t.currentProgressStep,10);t.progressSteps.length?(B(P),T(P),O>=t.progressSteps.length&&console.warn(\"SweetAlert2: Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)\"),t.progressSteps.forEach(function(e,n){var r=document.createElement(\"li\");if(E(r,a.progresscircle),r.innerHTML=e,n===O&&E(r,a.activeprogressstep),P.appendChild(r),n!==t.progressSteps.length-1){var o=document.createElement(\"li\");E(o,a.progressline),o.style.width=t.progressStepsDistance,P.appendChild(o)}})):L(P);for(var R=f(),I=0;I<R.length;I++)L(R[I]);if(t.type){var H=!1;for(var z in r)if(t.type===z){H=!0;break}if(!H)return console.error(\"SweetAlert2: Unknown alert type: \"+t.type),!1;var N=n.querySelector(\".\"+a.icon+\".\"+r[t.type]);if(B(N),t.animation)switch(t.type){case\"success\":E(N,\"swal2-animate-success-icon\"),E(N.querySelector(\".swal2-success-line-tip\"),\"swal2-animate-success-line-tip\"),E(N.querySelector(\".swal2-success-line-long\"),\"swal2-animate-success-line-long\");break;case\"error\":E(N,\"swal2-animate-error-icon\"),E(N.querySelector(\".swal2-x-mark\"),\"swal2-animate-x-mark\")}}var V=w();t.imageUrl?(V.setAttribute(\"src\",t.imageUrl),B(V),t.imageWidth?V.setAttribute(\"width\",t.imageWidth):V.removeAttribute(\"width\"),t.imageHeight?V.setAttribute(\"height\",t.imageHeight):V.removeAttribute(\"height\"),V.className=a.image,t.imageClass&&E(V,t.imageClass)):L(V),t.showCancelButton?S.style.display=\"inline-block\":L(S),t.showConfirmButton?q(b,\"display\"):L(b),t.showConfirmButton||t.showCancelButton?B(p):L(p),b.innerHTML=t.confirmButtonText,S.innerHTML=t.cancelButtonText,t.buttonsStyling&&(b.style.backgroundColor=t.confirmButtonColor,S.style.backgroundColor=t.cancelButtonColor),b.className=a.confirm,E(b,t.confirmButtonClass),S.className=a.cancel,E(S,t.cancelButtonClass),t.buttonsStyling?(E(b,a.styled),E(S,a.styled)):(A(b,a.styled),A(S,a.styled),b.style.backgroundColor=b.style.borderLeftColor=b.style.borderRightColor=\"\",S.style.backgroundColor=S.style.borderLeftColor=S.style.borderRightColor=\"\"),t.animation===!0?A(n,a.noanimation):E(n,a.noanimation)},_=function(e,t){var n=d(),r=u();e?(E(r,a.show),E(n,a.fade),A(r,a.hide)):A(r,a.fade),B(r),n.style.overflowY=\"hidden\",I&&!M(r,a.noanimation)?r.addEventListener(I,function e(){r.removeEventListener(I,e),n.style.overflowY=\"auto\"}):n.style.overflowY=\"auto\",E(document.documentElement,a.shown),E(document.body,a.shown),E(n,a.shown),K(),$(),s.previousActiveElement=document.activeElement,null!==t&&\"function\"==typeof t&&setTimeout(function(){t(r)})},K=function(){null===s.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(s.previousBodyPadding=document.body.style.paddingRight,document.body.style.paddingRight=z()+\"px\")},Y=function(){null!==s.previousBodyPadding&&(document.body.style.paddingRight=s.previousBodyPadding,s.previousBodyPadding=null)},$=function(){var e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(e&&!M(document.body,a.iosfix)){var t=document.body.scrollTop;document.body.style.top=t*-1+\"px\",E(document.body,a.iosfix)}},J=function(){if(M(document.body,a.iosfix)){var e=parseInt(document.body.style.top,10);A(document.body,a.iosfix),document.body.style.top=\"\",document.body.scrollTop=e*-1}},Z=function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(void 0===n[0])return console.error(\"SweetAlert2 expects at least 1 attribute!\"),!1;var i=V({},U);switch(j(n[0])){case\"string\":i.title=n[0],i.html=n[1],i.type=n[2];break;case\"object\":V(i,n[0]),i.extraParams=n[0].extraParams,\"email\"===i.input&&null===i.inputValidator&&(i.inputValidator=function(e){return new Promise(function(t,n){var a=/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,6}$/;a.test(e)?t():n(\"Invalid email address\")})}),\"url\"===i.input&&null===i.inputValidator&&(i.inputValidator=function(e){return new Promise(function(t,n){var a=/^https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_+.~#?&\\/\\/=]*)$/;a.test(e)?t():n(\"Invalid URL\")})});break;default:return console.error('SweetAlert2: Unexpected type of argument! Expected \"string\" or \"object\", got '+j(n[0])),!1}W(i);var l=d(),c=u();return new Promise(function(t,n){i.timer&&(c.timeout=setTimeout(function(){e.closeModal(i.onClose),i.useRejections?n(\"timer\"):t({dismiss:\"timer\"})},i.timer));var r=function(e){if(e=e||i.input,!e)return null;switch(e){case\"select\":case\"textarea\":case\"file\":return P(c,a[e]);case\"checkbox\":return c.querySelector(\".\"+a.checkbox+\" input\");case\"radio\":return c.querySelector(\".\"+a.radio+\" input:checked\")||c.querySelector(\".\"+a.radio+\" input:first-child\");case\"range\":return c.querySelector(\".\"+a.range+\" input\");default:return P(c,a.input)}},f=function(){var e=r();if(!e)return null;switch(i.input){case\"checkbox\":return e.checked?1:0;case\"radio\":return e.checked?e.value:null;case\"file\":return e.files.length?e.files[0]:null;default:return i.inputAutoTrim?e.value.trim():e.value}};i.input&&setTimeout(function(){var e=r();e&&C(e)},0);for(var p=function(n){i.showLoaderOnConfirm&&e.showLoading(),i.preConfirm?i.preConfirm(n,i.extraParams).then(function(a){e.closeModal(i.onClose),t(a||n)},function(t){e.hideLoading(),t&&e.showValidationError(t)}):(e.closeModal(i.onClose),t(i.useRejections?n:{value:n}))},M=function(a){var r=a||window.event,s=r.target||r.srcElement,l=x(),c=y(),d=l&&(l===s||l.contains(s)),u=c&&(c===s||c.contains(s));switch(r.type){case\"mouseover\":case\"mouseup\":i.buttonsStyling&&(d?l.style.backgroundColor=o(i.confirmButtonColor,-.1):u&&(c.style.backgroundColor=o(i.cancelButtonColor,-.1)));break;case\"mouseout\":i.buttonsStyling&&(d?l.style.backgroundColor=i.confirmButtonColor:u&&(c.style.backgroundColor=i.cancelButtonColor));break;case\"mousedown\":i.buttonsStyling&&(d?l.style.backgroundColor=o(i.confirmButtonColor,-.2):u&&(c.style.backgroundColor=o(i.cancelButtonColor,-.2)));break;case\"click\":if(d&&e.isVisible())if(e.disableButtons(),i.input){var h=f();i.inputValidator?(e.disableInput(),i.inputValidator(h,i.extraParams).then(function(){e.enableButtons(),e.enableInput(),p(h)},function(t){e.enableButtons(),e.enableInput(),t&&e.showValidationError(t)})):p(h)}else p(!0);else u&&e.isVisible()&&(e.disableButtons(),e.closeModal(i.onClose),i.useRejections?n(\"cancel\"):t({dismiss:\"cancel\"}))}},T=c.querySelectorAll(\"button\"),q=0;q<T.length;q++)T[q].onclick=M,T[q].onmouseover=M,T[q].onmouseout=M,T[q].onmousedown=M;k().onclick=function(){e.closeModal(i.onClose),i.useRejections?n(\"close\"):t({dismiss:\"close\"})},l.onclick=function(a){a.target===l&&i.allowOutsideClick&&(e.closeModal(i.onClose),i.useRejections?n(\"overlay\"):t({dismiss:\"overlay\"}))};var I=g(),H=x(),z=y();i.reverseButtons?H.parentNode.insertBefore(z,H):H.parentNode.insertBefore(H,z);var V=function(e,t){for(var n=S(i.focusCancel),a=0;a<n.length;a++){e+=t,e===n.length?e=0:e===-1&&(e=n.length-1);var r=n[e];if(O(r))return r.focus()}},U=function(a){var r=a||window.event,o=r.keyCode||r.which;if([9,13,32,27,37,38,39,40].indexOf(o)!==-1){for(var s=r.target||r.srcElement,l=S(i.focusCancel),c=-1,d=0;d<l.length;d++)if(s===l[d]){c=d;break}9===o?(r.shiftKey?V(c,-1):V(c,1),r.stopPropagation(),r.preventDefault()):37===o||38===o||39===o||40===o?document.activeElement===H&&O(z)?z.focus():document.activeElement===z&&O(H)&&H.focus():13===o||32===o?c===-1&&i.allowEnterKey&&(i.focusCancel?R(z,r):R(H,r),r.stopPropagation(),r.preventDefault()):27===o&&i.allowEscapeKey===!0&&(e.closeModal(i.onClose),i.useRejections?n(\"esc\"):t({dismiss:\"esc\"}))}};window.onkeydown&&window.onkeydown.toString()===U.toString()||(s.previousWindowKeyDown=window.onkeydown,window.onkeydown=U),i.buttonsStyling&&(H.style.borderLeftColor=i.confirmButtonColor,H.style.borderRightColor=i.confirmButtonColor),e.hideLoading=e.disableLoading=function(){i.showConfirmButton||(L(H),i.showCancelButton||L(g())),A(I,a.loading),A(c,a.loading),H.disabled=!1,z.disabled=!1},e.getTitle=function(){return h()},e.getContent=function(){return m()},e.getInput=function(){return r()},e.getImage=function(){return w()},e.getButtonsWrapper=function(){return g()},e.getConfirmButton=function(){return x()},e.getCancelButton=function(){return y()},e.enableButtons=function(){H.disabled=!1,z.disabled=!1},e.disableButtons=function(){H.disabled=!0,z.disabled=!0},e.enableConfirmButton=function(){H.disabled=!1},e.disableConfirmButton=function(){H.disabled=!0},e.enableInput=function(){var e=r();if(!e)return!1;if(\"radio\"===e.type)for(var t=e.parentNode.parentNode,n=t.querySelectorAll(\"input\"),a=0;a<n.length;a++)n[a].disabled=!1;else e.disabled=!1},e.disableInput=function(){var e=r();if(!e)return!1;if(e&&\"radio\"===e.type)for(var t=e.parentNode.parentNode,n=t.querySelectorAll(\"input\"),a=0;a<n.length;a++)n[a].disabled=!0;else e.disabled=!0},e.recalculateHeight=N(function(){var e=u();if(e){var t=e.style.display;e.style.minHeight=\"\",B(e),e.style.minHeight=e.scrollHeight+1+\"px\",e.style.display=t}},50),e.showValidationError=function(e){var t=b();t.innerHTML=e,B(t);var n=r();n&&(C(n),E(n,a.inputerror))},e.resetValidationError=function(){var t=b();L(t),e.recalculateHeight();var n=r();n&&A(n,a.inputerror)},e.getProgressSteps=function(){return i.progressSteps},e.setProgressSteps=function(e){i.progressSteps=e,W(i)},e.showProgressSteps=function(){B(v())},e.hideProgressSteps=function(){L(v())},e.enableButtons(),e.hideLoading(),e.resetValidationError();for(var D=[\"input\",\"file\",\"range\",\"select\",\"radio\",\"checkbox\",\"textarea\"],K=void 0,Y=0;Y<D.length;Y++){var $=a[D[Y]],J=P(c,$);if(K=r(D[Y])){for(var Z in K.attributes)if(K.attributes.hasOwnProperty(Z)){var F=K.attributes[Z].name;\"type\"!==F&&\"value\"!==F&&K.removeAttribute(F)}for(var Q in i.inputAttributes)K.setAttribute(Q,i.inputAttributes[Q])}J.className=$,i.inputClass&&E(J,i.inputClass),L(J)}var G=void 0;switch(i.input){case\"text\":case\"email\":case\"password\":case\"number\":case\"tel\":case\"url\":K=P(c,a.input),K.value=i.inputValue,K.placeholder=i.inputPlaceholder,K.type=i.input,B(K);break;case\"file\":K=P(c,a.file),K.placeholder=i.inputPlaceholder,K.type=i.input,B(K);break;case\"range\":var ee=P(c,a.range),te=ee.querySelector(\"input\"),ne=ee.querySelector(\"output\");te.value=i.inputValue,te.type=i.input,ne.value=i.inputValue,B(ee);break;case\"select\":var ae=P(c,a.select);if(ae.innerHTML=\"\",i.inputPlaceholder){var re=document.createElement(\"option\");re.innerHTML=i.inputPlaceholder,re.value=\"\",re.disabled=!0,re.selected=!0,ae.appendChild(re)}G=function(e){for(var t in e){var n=document.createElement(\"option\");n.value=t,n.innerHTML=e[t],i.inputValue===t&&(n.selected=!0),ae.appendChild(n)}B(ae),ae.focus()};break;case\"radio\":var oe=P(c,a.radio);oe.innerHTML=\"\",G=function(e){for(var t in e){var n=document.createElement(\"input\"),r=document.createElement(\"label\"),o=document.createElement(\"span\");n.type=\"radio\",n.name=a.radio,n.value=t,i.inputValue===t&&(n.checked=!0),o.innerHTML=e[t],r.appendChild(n),r.appendChild(o),r.for=n.id,oe.appendChild(r)}B(oe);var s=oe.querySelectorAll(\"input\");s.length&&s[0].focus()};break;case\"checkbox\":var ie=P(c,a.checkbox),se=r(\"checkbox\");se.type=\"checkbox\",se.value=1,se.id=a.checkbox,se.checked=Boolean(i.inputValue);var le=ie.getElementsByTagName(\"span\");le.length&&ie.removeChild(le[0]),le=document.createElement(\"span\"),le.innerHTML=i.inputPlaceholder,ie.appendChild(le),B(ie);break;case\"textarea\":var ce=P(c,a.textarea);ce.value=i.inputValue,ce.placeholder=i.inputPlaceholder,B(ce);break;case null:break;default:console.error('SweetAlert2: Unexpected type of input! Expected \"text\", \"email\", \"password\", \"number\", \"tel\", \"select\", \"radio\", \"checkbox\", \"textarea\", \"file\" or \"url\", got \"'+i.input+'\"')}\"select\"!==i.input&&\"radio\"!==i.input||(i.inputOptions instanceof Promise?(e.showLoading(),i.inputOptions.then(function(t){e.hideLoading(),G(t)})):\"object\"===j(i.inputOptions)?G(i.inputOptions):console.error(\"SweetAlert2: Unexpected type of inputOptions! Expected object or Promise, got \"+j(i.inputOptions))),_(i.animation,i.onOpen),i.allowEnterKey?V(-1,1):document.activeElement&&document.activeElement.blur(),d().scrollTop=0,\"undefined\"==typeof MutationObserver||X||(X=new MutationObserver(e.recalculateHeight),X.observe(c,{childList:!0,characterData:!0,subtree:!0}))})};return Z.isVisible=function(){return!!u()},Z.queue=function(e){D=e;var t=function(){D=[],document.body.removeAttribute(\"data-swal2-queue-step\")},n=[];return new Promise(function(e,a){!function r(o,i){o<D.length?(document.body.setAttribute(\"data-swal2-queue-step\",o),Z(D[o]).then(function(e){n.push(e),r(o+1,i)},function(e){t(),a(e)})):(t(),e(n))}(0)})},Z.getQueueStep=function(){return document.body.getAttribute(\"data-swal2-queue-step\")},Z.insertQueueStep=function(e,t){return t&&t<D.length?D.splice(t,0,e):D.push(e)},Z.deleteQueueStep=function(e){\"undefined\"!=typeof D[e]&&D.splice(e,1)},Z.close=Z.closeModal=function(e){var t=d(),n=u();if(n){A(n,a.show),E(n,a.hide),clearTimeout(n.timeout),H();var r=function(){t.parentNode&&t.parentNode.removeChild(t),A(document.documentElement,a.shown),A(document.body,a.shown),Y(),J()};I&&!M(n,a.noanimation)?n.addEventListener(I,function e(){n.removeEventListener(I,e),M(n,a.hide)&&r()}):r(),null!==e&&\"function\"==typeof e&&setTimeout(function(){e(n)})}},Z.clickConfirm=function(){return x().click()},Z.clickCancel=function(){return y().click()},Z.showLoading=Z.enableLoading=function(){var e=u();e||Z(\"\");var t=g(),n=x(),r=y();B(t),B(n,\"inline-block\"),E(t,a.loading),E(e,a.loading),n.disabled=!0,r.disabled=!0},Z.setDefaults=function(t){if(!t||\"object\"!==(\"undefined\"==typeof t?\"undefined\":j(t)))return console.error(\"SweetAlert2: the argument for setDefaults() is required and has to be a object\");for(var n in t)e.hasOwnProperty(n)||\"extraParams\"===n||(console.warn('SweetAlert2: Unknown parameter \"'+n+'\"'),delete t[n]);V(U,t)},Z.resetDefaults=function(){U=V({},e)},Z.noop=function(){},Z.version=\"6.6.6\",Z.default=Z,Z}),window.Sweetalert2&&(window.sweetAlert=window.swal=window.Sweetalert2)},function(e,t){self.fetch||(self.fetch=function(e,t){return t=t||{},new Promise(function(n,a){var r=new XMLHttpRequest,o=[],i=[],s={},l=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(JSON.parse(r.responseText))},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:l,headers:{keys:function(){return o},entries:function(){return i},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in r.open(t.method||\"get\",e,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\\S\\n]*([\\s\\S]*?)$/gm,function(e,t,n){o.push(t=t.toLowerCase()),i.push([t,n]),s[t]=s[t]?s[t]+\",\"+n:n}),n(l())},r.onerror=a,r.withCredentials=\"include\"==t.credentials,t.headers)r.setRequestHeader(c,t.headers[c]);r.send(t.body||null)})})},function(e,t){\"use strict\";function n(e,t,n){var a=r(e,3),o=a[0],i=a[1],s=a[2],l=r(t,3),c=l[0],d=l[1],u=l[2];return[o+(c-o)*n,i+(d-i)*n,s+(u-s)*n]}function a(e,t){t=Math.min(Math.max(t,0),1);var a=o[e],r=1===t?a.length-1:0===t?1:a.findIndex(function(e){return e.index>t}),i=a[r-1],s=a[r],l=n(i.rgb,s.rgb,(t-i.index)/(s.index-i.index));return l.map(Math.round)}Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}();t.default=a;var o={stars:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,255,255]}],space:[{index:0,rgb:[255,255,255]},{index:.05,rgb:[50,5,50]},{index:1,rgb:[15,5,15]}],hotish:[{index:0,rgb:[230,0,0]},{index:.3,rgb:[255,210,0]},{index:.5,rgb:[200,200,200]},{index:1,rgb:[255,255,255]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],magma:[{index:0,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:1,rgb:[254,194,135]}],magma2:[{index:0,rgb:[28,16,68]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],progress:[{index:0,rgb:[255,255,170]},{index:.072,rgb:[255,170,86]},{index:.142,rgb:[255,0,0]},{index:.249,rgb:[191,0,191]},{index:.35,rgb:[127,127,127]},{index:.47,rgb:[0,191,0]},{index:.63,rgb:[0,127,255]},{index:.805,rgb:[127,0,0]},{index:1,rgb:[0,0,0]}]}},function(e,t,n){\"use strict\";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(){D=\"aiming\",Z=2,F=Array.from(new Array(Z-1),function(){return\"ball\"}),Q=Array.from(F),Y=[],$=[],J=[],U=0,j.innerHTML=U,oe=[],ie=new Set,_=void 0;for(var e=0;e<4;e++)i()}function i(){oe.forEach(function(e){e[0]++}),ie.forEach(function(e){e[0]++});for(var e=.5,t=.2,n=0;n<ne;n++)Math.random()<=e?oe.push([0,n,Z]):Math.random()<=t&&(5==Z?ie.add([0,n,\"laser\"]):Z>5&&Z<15&&Math.random()>.5?ie.add([0,n,\"laser\"]):Z>15&&Math.random()>.95?ie.add([0,n,\"laser\"]):ie.add([0,n,\"ball\"]))}function s(e){se++;var t=(e-ve)/1e3;ve=e,requestAnimationFrame(s);var n=document.getElementById(\"canvas-wrap\").getBoundingClientRect(),a=n.width,r=n.height;if(canvas.width=2*a,canvas.height=2*r,G=Math.max(Math.min(2e3,canvas.width),1500),S(t),M(t),y(e,t),\"playing\"===D)if(Q.length){if(se%3==0){var o=Q.shift();if(\"ball\"===o){var l=le(),c=ee,d=_||canvas.width/2,u=O()-c;Y.push({x:d,y:u,vx:Math.cos(l)*G,vy:-1*Math.sin(l)*G,r:c,type:o,last:!Q.filter(function(e){return\"ball\"===e}).length})}else if(\"laser\"===o){var f=le(Math.sin(Q.length/8*Math.PI)*Math.PI/100),p=ee,h=_||canvas.width/2,m=O()-p,w=[h,m],g=Math.cos(f)*(canvas.width+canvas.height),v=-Math.sin(f)*(canvas.width+canvas.height),b=[h+g,m+v];oe.forEach(function(e){var t=q(e,3),n=t[0],a=t[1],r=t[2];if(!(r<=0)){var o=T(n,a),i=B(o,w,[1/g,1/v],canvas.width+canvas.height);if(i){var s=o.x,l=o.y,c=o.w,d=o.h,u=[[[s,l],[s+c,l]],[[s+c,l],[s+c,l+d]],[[s+c,l+d],[s,l+d]],[[s,l+d],[s,l]]];u.forEach(function(t){var n=he(w,[g,v],t[0],de(t[1],t[0]));n&&!ge(n,w)&&ce(n,w,b)&&ce(n,t[0],t[1])&&(A({vx:g,vy:v,vr:100,f:.1,x:n[0],y:n[1],r:1,lifetime:Math.random(),color:\"rgba(\"+(0,z.default)(\"progress\",r/125)+\",1)\"}),e[2]--,C())})}}}),A({x:h,y:m,toX:b[0],toY:b[1],r:1,vr:150,fade:!0,color:\"#aaf\",lifetime:.2}),A({x:h,y:m,toX:b[0],toY:b[1],r:2,fade:!0,color:re,lifetime:.2})}}}else Y.every(function(e){return e.gathered})&&(Y=[],Z++,_=K,Q=Array.from(F),D=\"levelup\",X=e,i())}function l(e){32==e.keyCode&&d()}function c(e){if(\"aiming\"==D){var t=canvas.getBoundingClientRect(),n=e.touches[0].pageX,a=e.touches[0].pageY;W={x:2*(n-t.left),y:2*(a-t.top)}}}function d(){\"aiming\"===D&&(Y=[],D=\"playing\")}function u(){N.save(),N.strokeStyle=ae,N.lineWidth=10,N.globalAlpha=.3,J.forEach(function(e){var t,n,a=q(e,2),o=a[0],i=a[1];N.beginPath(),(t=N).moveTo.apply(t,r(o)),(n=N).lineTo.apply(n,r(i)),N.stroke()}),N.restore()}function f(){Y.forEach(function(e){var t=e.x,n=e.y,a=(e.vx,e.vy,e.r),r=e.type;e.last;N.beginPath(),\"ball\"===r?(N.fillStyle=ae,N.arc(t,n,a,0,2*Math.PI)):\"laser\"===r&&(N.fillStyle=re,N.fillRect(t-a/2,n-a,a,2*a)),N.fill()})}function p(){var e=_||canvas.width/2,t=O()-ee,n=Math.sqrt(canvas.height*canvas.height+canvas.width*canvas.width),a=le();N.save(),N.strokeStyle=\"#aaa\",N.beginPath(),N.setLineDash([5,15]),N.lineWidth=5,N.moveTo(e,t),N.lineTo(e+n*Math.cos(a),t-n*Math.sin(a)),N.stroke(),N.restore(),N.beginPath(),N.fillStyle=ae,N.arc(e,t,ee,0,2*Math.PI),N.fill()}function h(e,t){var n=q(e,3),a=n[0],r=n[1],o=n[2];if(!(o<=0)){var i=T(a,r),s=i.w,l=i.h,c=i.x,d=i.y,u=i.cx,f=i.cy,p=t?10*(Math.random()-.5):0,h=t?10*(Math.random()-.5):0;if(N.fillStyle=\"rgba(\"+(0,z.default)(\"progress\",o/125)+\",1)\",N.fillRect(c+p,d+h,s,l),o>130){var m=Math.min((o-130)/60,1);if(Math.random()<m/10){A({type:\"circle\",x:c+Math.random()*s,y:d+Math.random()*l,lifetime:3,color:\"rgba(\"+(0,z.default)(\"stars\",m)+\",1)\",fade:!0,r:3*Math.random()})}}N.textBaseline=\"middle\",N.textAlign=\"center\",N.font=\"40px Avenir\",N.fillStyle=\"black\",N.fillText(o,u+p,f+h+2),N.fillStyle=\"white\",N.fillText(o,u+p,f+h)}}function m(){oe.forEach(function(e){return h(e)}),oe.filter(function(e){return e.hit}).forEach(function(e){return h(e,!0)})}function w(e){ie.forEach(function(t){var n=q(t,3),a=n[0],r=n[1],o=n[2];if(\"ball\"==o){var i=T(a,r),s=(i.w,i.h,i.x,i.y,i.cx),l=i.cy;N.fillStyle=ae,N.beginPath(),N.arc(s,l,10,0,2*Math.PI),N.fill(),N.strokeStyle=ae,N.beginPath(),N.arc(s,l,20+5*Math.sin(e/300),0,2*Math.PI),N.stroke()}else if(\"laser\"==o){var c=T(a,r),d=(c.w,c.h,c.x,c.y,c.cx),u=c.cy;N.fillStyle=re,N.fillRect(d-5,u-10,10,20),N.strokeStyle=re,N.beginPath(),N.arc(d,u,20+5*Math.sin(e/300),0,2*Math.PI),N.stroke()}})}function g(){$.forEach(function(e){var t=e.x,n=e.y,a=e.r,r=e.vx,o=e.vy,i=e.toX,s=e.toY,l=e.age,c=e.lifetime,d=e.text,u=e.color,f=e.fade,p=(e.startColor,e.endColor,e.colormap),h=e.type,m=Math.max(1-l/c,0);f&&(N.globalAlpha=m),p&&(u=\"rgba(\"+(0,z.default)(p,1-m)+\",1)\"),u&&(N.fillStyle=u,N.strokeStyle=u),\"text\"===h?(N.font=a+\"px Avenir\",N.fillText(d,t,n)):\"circle\"===h?(N.beginPath(),N.arc(t,n,a,0,2*Math.PI),N.fill()):(N.beginPath(),N.lineWidth=a,N.moveTo(t,n),\"undefined\"!=typeof i?N.lineTo(i,s):N.lineTo(t+r/10,n+o/10),N.stroke()),N.globalAlpha=1})}function v(){N.fillStyle=\"rgba(0,0,0,.3)\",N.fillRect(0,0,canvas.width,canvas.height),N.textBaseline=\"middle\",N.textAlign=\"center\";var e=canvas.width/15;N.font=e+\"px Avenir\";var t=[\"You Lose 😱\",\"あなたは失う 😱\",\"Tu Perdiste 😱\",\"أنت تفقد 😱\",\"Tu As Perdu 😱\",\"你输了 😱\"];N.fillStyle=\"#f0f0f0\",N.fillText(t[Math.floor(Date.now()/1500)%t.length],canvas.width/2,canvas.height/2),N.font=\"30px Avenir\",N.fillText(\"[tap to restart]\",canvas.width/2,canvas.height/2+e/2+20)}function b(e,t){if(N.save(),Z<=120)N.clearRect(0,0,canvas.width,canvas.height);else{121===Z&&\"levelup\"==D&&(N.globalAlpha=e);for(var n=canvas.width/2,a=canvas.height/2,r=Math.max(canvas.width,canvas.height),o=t/1e4,i=N.createLinearGradient(n-Math.sin(o)*r,a-Math.cos(o)*r,n+Math.sin(o)*r,a+Math.cos(o)*r),s=0;s<3;s++){var l=(t+1e4*s)/1e3;i.addColorStop(s/3,\"hsl(\"+(Math.sin(l)+1)/2*100+\", 20%, 10%)\")}N.fillStyle=i,N.fillRect(0,0,canvas.width,canvas.height)}N.restore()}function x(e){var t=-T(0,0).h,n=e-X,a=-1,r=a*n;return{total:t,r:Math.min(r/t,1)}}function y(e,t){var n=x(e),a=n.r,r=n.total;b(a,e),N.fillStyle=\"rgba(180,180,180,.3)\",N.fillRect(0,O(),canvas.width,canvas.height-O()),u(),f(),\"aiming\"===D&&p(),\"levelup\"==D&&(p(),a<1?N.translate(0,r*(1-a)):(D=\"aiming\",oe.forEach(function(e){e[0]===te-1&&e[2]>0&&(\"lost\"!=D&&k(),D=\"lost\")}))),m(),w(e),g(),\"lost\"===D&&v()}function k(){var e=(localStorage.username,localStorage.pr||0);if(console.log(\"Game state lost\"),U>e){V.innerHTML=U;try{localStorage.pr=U;}catch(e){}(0,I.default)({title:\"New high score!\",text:U+\" is your new personal record.\",input:\"text\",inputPlaceholder:\"Nickname for Leaderboard\",inputValue:localStorage.username||\"\",showCancelButton:!0,confirmButtonText:\"Submit\",reverseButtons:!0,inputValidator:function(e){return new Promise(function(t,n){return e?t():n(\"You need to write something!\")})}}).then(function(e){try{localStorage.username=e}catch(e){}var t=new FormData;t.set(\"data\",JSON.stringify({username:e,score:U})),fetch(\"/scores\",{method:\"POST\",body:t}).then(function(e){return e.text()}).then(function(e){return console.log(e)})}).catch(function(e){console.warn(e)})}var t=function e(t){t.preventDefault(),o(),canvas.removeEventListener(\"click\",e),canvas.removeEventListener(\"touchend\",e)};canvas.addEventListener(\"click\",t),canvas.addEventListener(\"touchend\",t)}function S(e){oe.forEach(function(e){return e.hit=!1}),J=[],Y.forEach(function(t){if(t.done){var n=K-(t.x+e*t.vx);(Math.abs(n)<1e-8||n/t.gather_dir<0)&&(t.x=K,t.vx=0,t.gathered=!0)}E(t,e),t.y>O()-t.r&&!t.done&&(t.y=O()-t.r,t.vx=0,t.vy=0,Y.some(function(e){return e.done})?(t.vx=(K-t.x)*(2+Math.random()),t.gather_dir=K-t.x||1):(K=Math.min(Math.max(t.x,t.r),canvas.width-t.r),t.gathered=!0),t.done=!0)})}function M(e){var t=[];$.forEach(function(n){n.age||(n.age=0),n.age>n.lifetime||(n.vx+=n.ax*e,n.vy+=n.ay*e,n.vx*=1-n.f,n.vy*=1-n.f,n.vr+=n.ar*e,n.x+=n.vx*e,n.y+=n.vy*e,n.r+=n.vr*e,n.r<0||(n.age+=e,t.push(n)))}),$=t}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;U+=e,j.innerHTML=U,j.style.transition=\"none\",j.className=\"gold\",setTimeout(function(){j.style.transition=\"1s\",j.className=\"\"},0)}function E(e,t){for(var n=e.r,a=Math.sqrt(e.vx*e.vx+e.vy*e.vy),o=a*t,i=function(){var t=L([e.vx,e.vy]),i=q(t,2),l=i[0],c=i[1],d=[1/l,1/c],u=[e.x,e.y],f=[e.x+l*o,e.y+c*o];if(isNaN(f[0]))throw\"walp\";var p=1/0,h=void 0,m=void 0,w=void 0,g=[[[n,0],[n,canvas.height-n]],[[canvas.width-n,canvas.height-n],[canvas.width-n,n]],[[canvas.width-n,n],[n,n]]];if(e.done||e.falling||g.forEach(function(e){var t=he(u,de(u,f),e[0],de(e[1],e[0]));if(t&&!ge(t,u)&&ce(t,u,f)&&ce(t,e[0],e[1])){var n=fe(u,t);n<p&&(p=n,h=t,w=L(me(e[0],e[1])),m=!1)}}),e.done||e.falling||oe.forEach(function(e){var t=q(e,3),a=t[0],r=t[1],i=t[2];if(!(i<=0)){var s=T(a,r),l=B({x:s.x-n,y:s.y-n,w:s.w+2*n,h:s.h+2*n},u,d,o);if(l){var c=s.x,g=s.y,v=s.w,b=s.h,x=[[c,g],[c+v,g],[c+v,g+b],[c,g+b]],y=[[[c,g-n],[c+v,g-n]],[[c+v+n,g],[c+v+n,g+b]],[[c+v,g+b+n],[c,g+b+n]],[[c-n,g+b],[c-n,g]]];y.forEach(function(t){var n=he(u,de(u,f),t[0],de(t[1],t[0]));if(n&&!ge(n,u)&&ce(n,u,f)&&ce(n,t[0],t[1])){var a=fe(u,n);a<p&&(p=a,h=n,w=L(me(t[0],t[1])),m=e)}}),x.forEach(function(t){var a=P(u,f,t,n);if(a){var r=q(a,2),o=r[0],i=r[1],s=fe(o,u),l=fe(i,u);ce(o,u,f)&&s<p&&!ge(o,u)&&(p=s,h=o,w=L(de(o,t)),m=e),ce(i,u,f)&&l<p&&!ge(i,u)&&(p=l,h=i,w=L(de(i,t)),m=e)}})}}}),ie.forEach(function(t){var n=q(t,3),a=n[0],r=n[1],o=n[2],i=T(a,r),s=i.cx,l=i.cy,c=e.r+30;if(fe([e.x,e.y],[s,l])<c*c)if(ie.delete(t),\"ball\"===o){F.push(\"ball\");(Math.random()-.5)*Math.PI*1/16+Math.atan2(e.vy,e.vx);Y.push({x:s,y:l,vx:0,vy:G,r:ee,falling:!0,type:\"ball\"}),A({x:s,y:l,lifetime:.3,r:10,vr:200,type:\"circle\",fade:!0,color:ae})}else\"laser\"===o&&(F.push(\"laser\"),Y.push({x:s,y:l,vx:0,vy:G,r:ee,falling:!0,type:\"laser\"}))}),h){var v=we(de(f,u),w),b=ue(L(de(de(f,u),ue(w,2*v))),a);if(e.x=h[0],e.y=h[1],e.vx=b[0],e.vy=b[1],o-=pe(h,u),m){var x=1;for(m.hit=!0,s=0;s<x;s++){var y=ue(L(de(de(f,u),ue(w,(1+Math.random())*v))),a*Math.random());A({vx:y[0],vy:y[1],vr:100,f:.1,x:h[0],y:h[1],r:1,lifetime:Math.random(),color:\"rgba(\"+(0,z.default)(\"progress\",m[2]/125)+\",1)\"}),m[2]--}if(C(x),m[2]<=0)for(s=0;s<10;s++){var k=T.apply(void 0,r(m)),S=k.cx,M=k.cy,E=2*Math.random()*Math.PI,O=Math.random();A({vx:1e3*Math.cos(E)*O,vy:1e3*Math.sin(E)*O,vr:100,f:.1,x:S,y:M,r:1,lifetime:Math.random(),color:\"#ddd\"})}}}else e.x=f[0],e.y=f[1],o=0;J.push([u,[e.x,e.y]])};o>0;){var s,s;i()}}function A(e){$.push(Object.assign({ax:0,ay:0,ar:0,vx:0,vy:0,vr:0,f:0,x:canvas.width/2,y:canvas.height/2,r:10,lifetime:1},e))}function P(e,t,n,a){var r=q(n,2),o=r[0],i=r[1],s=q(e,2),l=s[0],c=s[1],d=q(t,2),u=d[0],f=d[1],p=u-l,h=f-c,m=p*p+h*h,w=p*(o-l)+h*(i-c),g=4*w*w-4*m*(o*o-2*o*l+i*i-2*i*c-a*a+l*l+c*c);if(g<0)return!1;var v=p*o-p*l+h*i-h*c,b=Math.sqrt(g),x=(b/2+v)/m,y=(-b/2+v)/m;return[[l+x*p,c+x*h],[l+y*p,c+y*h]]}function B(e,t,n,a){var r=q(t,2),o=r[0],i=r[1],s=q(n,2),l=s[0],c=s[1],d=(e.x-o)*l,u=(e.x+e.w-o)*l,f=Math.min(d,u),p=Math.max(d,u),h=(e.y-i)*c,m=(e.y+e.h-i)*c;return f=Math.max(f,Math.min(h,m)),p=Math.min(p,Math.max(h,m)),p>Math.max(f,0)&&f<a}function L(e){var t=q(e,2),n=t[0],a=t[1],r=Math.sqrt(n*n+a*a);return[n/r,a/r]}function T(e,t){var n=canvas.width/ne,a=O()/te;return{w:n,h:a,x:n*t,y:a*e,cx:n*(t+.5),cy:a*(e+.5)}}function O(){return canvas.height-30}var q=function(){function e(e,t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),R=n(3),I=a(R);n(10),n(7);var H=n(5),z=a(H);n(4),n(11);var N=void 0,j=void 0,V=void 0,U=void 0,D=void 0,X=void 0,W={x:0,y:0},_=void 0,K=void 0,Y=void 0,$=void 0,J=void 0,Z=void 0,F=void 0,Q=void 0,G=void 0,ee=10,te=(Math.PI/12,10),ne=10,ae=\"#48f\",re=\"#691c7e\",oe=[],ie=new Set,se=0;document.getElementById(\"canvas-wrap\").addEventListener(\"mousemove\",function(e){if(\"aiming\"===D||\"levelup\"==D){var t=canvas.getBoundingClientRect();W={x:2*(e.clientX-t.left),y:2*(e.clientY-t.top)}}}),document.getElementById(\"canvas-wrap\").addEventListener(\"keypress\",l,!0),document.getElementById(\"canvas-wrap\").addEventListener(\"click\",d,!0),document.getElementById(\"canvas-wrap\").addEventListener(\"touchmove\",c,!0),document.getElementById(\"canvas-wrap\").addEventListener(\"touchend\",d,!0),document.addEventListener(\"touchstart\",function(e){e.target===canvas&&(console.log(\"preventing scroll\"),e.preventDefault())},{passive:!1}),end_button.addEventListener(\"click\",function(e){Y.filter(function(e){return!e.falling&&!e.done&&!e.gathered}).forEach(function(e){e.vx=0,e.vy=G,e.falling=!0})});var le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=ee,n=_||canvas.width/2,a=O()-t,r=W.x-n,o=W.y-a,i=Math.atan2(-o,r)+e;i<-Math.PI/2&&(i=Math.PI);var s=canvas.width*(ne-1)/ne/2,l=Math.atan2(canvas.height/te,-s),c=Math.atan2(canvas.height/te,s);return i=Math.min(Math.max(c,i),l)};window.swal=I.default;var ce=function(e,t,n){var a=q(e,2),r=a[0],o=a[1],i=q(t,2),s=i[0],l=i[1],c=q(n,2),d=c[0],u=c[1];return r>=Math.min(s,d)&&r<=Math.max(s,d)&&o>=Math.min(l,u)&&o<=Math.max(l,u)},de=function(e,t){var n=q(e,2),a=n[0],r=n[1],o=q(t,2),i=o[0],s=o[1];return[a-i,r-s]},ue=function(e,t){var n=q(e,2),a=n[0],r=n[1];return[a*t,r*t]},fe=function(e,t){var n=de(e,t),a=q(n,2),r=a[0],o=a[1];return r*r+o*o},pe=function(e,t){return Math.sqrt(fe(e,t))},he=function(e,t,n,a){var r=q(e,2),o=r[0],i=r[1],s=q(t,2),l=s[0],c=s[1],d=q(n,2),u=d[0],f=d[1],p=q(a,2),h=p[0],m=p[1],w=h*c-m*l;if(0===w)return!1;var g=(l*(f-i)+c*(o-u))/w;return[u+g*h,f+g*m]},me=function(e,t){var n=q(e,2),a=n[0],r=n[1],o=q(t,2),i=o[0],s=o[1];return[s-r,a-i]},we=function(e,t){var n=q(e,2),a=n[0],r=n[1],o=q(t,2),i=o[0],s=o[1];return a*i+r*s},ge=function(e,t){var n=q(e,2),a=n[0],r=n[1],o=q(t,2),i=o[0],s=o[1];return Math.abs(a-i)<1e-8&&Math.abs(r-s)<1e-8},ve=void 0;N=canvas.getContext(\"2d\"),j=document.getElementById(\"score\"),V=document.getElementById(\"record\"),V.innerHTML=localStorage.pr||0,o(),requestAnimationFrame(function(e){ve=e,requestAnimationFrame(s)})},function(e,t,n){\"use strict\";function a(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=document.createElement(\"div\");return t.appendChild(document.createTextNode(e)),t.innerHTML}var o=n(3),i=a(o);n(4);var s=function(e){fetch(\"/scores\").then(function(e){return e.text()}).then(function(t){var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=t.split(\"\\n\")[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;try{n.push(JSON.parse(l))}catch(e){console.warn(l,e)}}}catch(e){r=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(r)throw o}}n.sort(function(e,t){return t.score-e.score}).slice(0,100),e(n)},function(e){console.warn(e)})};document.getElementById(\"scoreboardButton\").addEventListener(\"click\",function(){return s(function(e){console.log(e);var t='<div style=\"overflow: scroll; max-height: 300px\">\\n      <table id=\"scoreTable\" style=\"width: 100%;\">\\n        <tbody>\\n          <tr>\\n            <th align=\"left\" style=\"width: 10%;\">Place</th>\\n            <th align=\"center\" style=\"width: 50%;\">Username</th>\\n            <th align=\"center\" style=\"width: 40%;\">Score</th>\\n          </tr>\\n          '+e.map(function(e,t){var n=e.username,a=e.score;return'<tr>\\n            <td align=\"center\" style=\"width: 10%; padding: 5px;\">'+(t+1)+'</td>\\n            <td align=\"center\" style=\"width: 50%; padding: 5px;\">'+r(n)+'</td>\\n            <td align=\"center\" style=\"width: 40%; padding: 5px;\">'+r(a)+\"</td>\\n          </tr>\"}).join(\"\")+\"\\n        </tbody>\\n      </table>\\n    </div>\";(0,i.default)({title:\"GKC Top Scores\",html:t})})})},function(e,t,n){t=e.exports=n(1)(),t.push([e.id,'body.swal2-shown{overflow-y:hidden}.swal2-container,body.swal2-iosfix{position:fixed;left:0;right:0}.swal2-container{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;top:0;bottom:0;padding:10px;background-color:transparent;z-index:1060}.swal2-container.swal2-fade{-webkit-transition:background-color .1s;transition:background-color .1s}.swal2-container.swal2-shown{background-color:rgba(0,0,0,.4)}.swal2-modal{background-color:#fff;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;border-radius:5px;-webkit-box-sizing:border-box;box-sizing:border-box;text-align:center;margin:auto;overflow-x:hidden;overflow-y:auto;display:none;position:relative;max-width:100%}.swal2-modal:focus{outline:none}.swal2-modal.swal2-loading{overflow-y:hidden}.swal2-modal .swal2-title{color:#595959;font-size:30px;text-align:center;font-weight:600;text-transform:none;position:relative;margin:0 0 .4em;padding:0;display:block;word-wrap:break-word}.swal2-modal .swal2-buttonswrapper{margin-top:15px}.swal2-modal .swal2-buttonswrapper:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4;cursor:no-drop}.swal2-modal .swal2-buttonswrapper.swal2-loading .swal2-styled.swal2-confirm{-webkit-box-sizing:border-box;box-sizing:border-box;border:4px solid transparent;border-color:transparent;width:40px;height:40px;padding:0;margin:7.5px;vertical-align:top;background-color:transparent!important;color:transparent;cursor:default;border-radius:100%;-webkit-animation:rotate-loading 1.5s linear 0s infinite normal;animation:rotate-loading 1.5s linear 0s infinite normal;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-modal .swal2-buttonswrapper.swal2-loading .swal2-styled.swal2-cancel{margin-left:30px;margin-right:30px}.swal2-modal .swal2-buttonswrapper.swal2-loading :not(.swal2-styled).swal2-confirm:after{display:inline-block;content:\"\";margin-left:5px 0 15px;vertical-align:-1px;height:15px;width:15px;border:3px solid #999;-webkit-box-shadow:1px 1px 1px #fff;box-shadow:1px 1px 1px #fff;border-right-color:transparent;border-radius:50%;-webkit-animation:rotate-loading 1.5s linear 0s infinite normal;animation:rotate-loading 1.5s linear 0s infinite normal}.swal2-modal .swal2-styled{border:0;border-radius:3px;-webkit-box-shadow:none;box-shadow:none;color:#fff;cursor:pointer;font-size:17px;font-weight:500;margin:15px 5px 0;padding:10px 32px}.swal2-modal .swal2-image{margin:20px auto;max-width:100%}.swal2-modal .swal2-close{background:transparent;border:0;margin:0;padding:0;width:38px;height:40px;font-size:36px;line-height:40px;font-family:serif;position:absolute;top:5px;right:8px;cursor:pointer;color:#ccc;-webkit-transition:color .1s ease;transition:color .1s ease}.swal2-modal .swal2-close:hover{color:#d55}.swal2-modal>.swal2-checkbox,.swal2-modal>.swal2-file,.swal2-modal>.swal2-input,.swal2-modal>.swal2-radio,.swal2-modal>.swal2-select,.swal2-modal>.swal2-textarea{display:none}.swal2-modal .swal2-content{font-size:18px;text-align:center;font-weight:300;position:relative;float:none;margin:0;padding:0;line-height:normal;color:#545454;word-wrap:break-word}.swal2-modal .swal2-checkbox,.swal2-modal .swal2-file,.swal2-modal .swal2-input,.swal2-modal .swal2-radio,.swal2-modal .swal2-select,.swal2-modal .swal2-textarea{margin:20px auto}.swal2-modal .swal2-file,.swal2-modal .swal2-input,.swal2-modal .swal2-textarea{width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;font-size:18px;border-radius:3px;border:1px solid #d9d9d9;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.06);box-shadow:inset 0 1px 1px rgba(0,0,0,.06);-webkit-transition:border-color box-shadow .3s;transition:border-color box-shadow .3s}.swal2-modal .swal2-file.swal2-inputerror,.swal2-modal .swal2-input.swal2-inputerror,.swal2-modal .swal2-textarea.swal2-inputerror{border-color:#f27474!important;-webkit-box-shadow:0 0 2px #f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-modal .swal2-file:focus,.swal2-modal .swal2-input:focus,.swal2-modal .swal2-textarea:focus{outline:none;border:1px solid #b4dbed;-webkit-box-shadow:0 0 3px #c4e6f5;box-shadow:0 0 3px #c4e6f5}.swal2-modal .swal2-file:focus::-webkit-input-placeholder,.swal2-modal .swal2-input:focus::-webkit-input-placeholder,.swal2-modal .swal2-textarea:focus::-webkit-input-placeholder{-webkit-transition:opacity .3s ease .03s;transition:opacity .3s ease .03s;opacity:.8}.swal2-modal .swal2-file:focus:-ms-input-placeholder,.swal2-modal .swal2-input:focus:-ms-input-placeholder,.swal2-modal .swal2-textarea:focus:-ms-input-placeholder{-webkit-transition:opacity .3s ease .03s;transition:opacity .3s ease .03s;opacity:.8}.swal2-modal .swal2-file:focus::placeholder,.swal2-modal .swal2-input:focus::placeholder,.swal2-modal .swal2-textarea:focus::placeholder{-webkit-transition:opacity .3s ease .03s;transition:opacity .3s ease .03s;opacity:.8}.swal2-modal .swal2-file::-webkit-input-placeholder,.swal2-modal .swal2-input::-webkit-input-placeholder,.swal2-modal .swal2-textarea::-webkit-input-placeholder{color:#e6e6e6}.swal2-modal .swal2-file:-ms-input-placeholder,.swal2-modal .swal2-input:-ms-input-placeholder,.swal2-modal .swal2-textarea:-ms-input-placeholder{color:#e6e6e6}.swal2-modal .swal2-file::placeholder,.swal2-modal .swal2-input::placeholder,.swal2-modal .swal2-textarea::placeholder{color:#e6e6e6}.swal2-modal .swal2-range input{float:left;width:80%}.swal2-modal .swal2-range output{float:right;width:20%;font-size:20px;font-weight:600;text-align:center}.swal2-modal .swal2-range input,.swal2-modal .swal2-range output{height:43px;line-height:43px;vertical-align:middle;margin:20px auto;padding:0}.swal2-modal .swal2-input{height:43px;padding:0 12px}.swal2-modal .swal2-input[type=number]{max-width:150px}.swal2-modal .swal2-file{font-size:20px}.swal2-modal .swal2-textarea{height:108px;padding:12px}.swal2-modal .swal2-select{color:#545454;font-size:inherit;padding:5px 10px;min-width:40%;max-width:100%}.swal2-modal .swal2-radio{border:0}.swal2-modal .swal2-radio label:not(:first-child){margin-left:20px}.swal2-modal .swal2-radio input,.swal2-modal .swal2-radio span{vertical-align:middle}.swal2-modal .swal2-radio input{margin:0 3px 0 0}.swal2-modal .swal2-checkbox{color:#545454}.swal2-modal .swal2-checkbox input,.swal2-modal .swal2-checkbox span{vertical-align:middle}.swal2-modal .swal2-validationerror{background-color:#f0f0f0;margin:0 -20px;overflow:hidden;padding:10px;color:gray;font-size:16px;font-weight:300;display:none}.swal2-modal .swal2-validationerror:before{content:\"!\";display:inline-block;width:24px;height:24px;border-radius:50%;background-color:#ea7d7d;color:#fff;line-height:24px;text-align:center;margin-right:10px}@supports (-ms-accelerator:true){.swal2-range input{width:100%!important}.swal2-range output{display:none}}@media (-ms-high-contrast:active),(-ms-high-contrast:none){.swal2-range input{width:100%!important}.swal2-range output{display:none}}.swal2-icon{width:80px;height:80px;border:4px solid transparent;border-radius:50%;margin:20px auto 30px;padding:0;position:relative;-webkit-box-sizing:content-box;box-sizing:content-box;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-icon.swal2-error{border-color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;display:block}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{position:absolute;height:5px;width:47px;background-color:#f27474;display:block;top:37px;border-radius:2px}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{-webkit-transform:rotate(45deg);transform:rotate(45deg);left:17px}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{-webkit-transform:rotate(-45deg);transform:rotate(-45deg);right:16px}.swal2-icon.swal2-warning{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;color:#f8bb86;border-color:#facea8}.swal2-icon.swal2-info,.swal2-icon.swal2-warning{font-size:60px;line-height:80px;text-align:center}.swal2-icon.swal2-info{font-family:Open Sans,sans-serif;color:#3fc3ee;border-color:#9de0f6}.swal2-icon.swal2-question{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;color:#87adbd;border-color:#c9dae1;font-size:60px;line-height:80px;text-align:center}.swal2-icon.swal2-success{border-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{border-radius:50%;position:absolute;width:60px;height:120px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{border-radius:120px 0 0 120px;top:-7px;left:-33px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:60px 60px;transform-origin:60px 60px}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{border-radius:0 120px 120px 0;top:-11px;left:30px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg);-webkit-transform-origin:0 60px;transform-origin:0 60px}.swal2-icon.swal2-success .swal2-success-ring{width:80px;height:80px;border:4px solid hsla(98,55%,69%,.2);border-radius:50%;-webkit-box-sizing:content-box;box-sizing:content-box;position:absolute;left:-4px;top:-4px;z-index:2}.swal2-icon.swal2-success .swal2-success-fix{width:7px;height:90px;position:absolute;left:28px;top:8px;z-index:1;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{height:5px;background-color:#a5dc86;display:block;border-radius:2px;position:absolute;z-index:2}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{width:25px;left:14px;top:46px;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{width:47px;right:8px;top:38px;-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.swal2-progresssteps{font-weight:600;margin:0 0 20px;padding:0}.swal2-progresssteps li{display:inline-block;position:relative}.swal2-progresssteps .swal2-progresscircle{background:#3085d6;border-radius:2em;color:#fff;height:2em;line-height:2em;text-align:center;width:2em;z-index:20}.swal2-progresssteps .swal2-progresscircle:first-child{margin-left:0}.swal2-progresssteps .swal2-progresscircle:last-child{margin-right:0}.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep{background:#3085d6}.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep~.swal2-progresscircle,.swal2-progresssteps .swal2-progresscircle.swal2-activeprogressstep~.swal2-progressline{background:#add8e6}.swal2-progresssteps .swal2-progressline{background:#3085d6;height:.4em;margin:0 -1px;z-index:10}[class^=swal2]{-webkit-tap-highlight-color:transparent}@-webkit-keyframes showSweetAlert{0%{-webkit-transform:scale(.7);transform:scale(.7)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes showSweetAlert{0%{-webkit-transform:scale(.7);transform:scale(.7)}45%{-webkit-transform:scale(1.05);transform:scale(1.05)}80%{-webkit-transform:scale(.95);transform:scale(.95)}to{-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes hideSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(.5);transform:scale(.5);opacity:0}}@keyframes hideSweetAlert{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}to{-webkit-transform:scale(.5);transform:scale(.5);opacity:0}}.swal2-show{-webkit-animation:showSweetAlert .3s;animation:showSweetAlert .3s}.swal2-show.swal2-noanimation{-webkit-animation:none;animation:none}.swal2-hide{-webkit-animation:hideSweetAlert .15s forwards;animation:hideSweetAlert .15s forwards}.swal2-hide.swal2-noanimation{-webkit-animation:none;animation:none}@-webkit-keyframes animate-success-tip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@keyframes animate-success-tip{0%{width:0;left:1px;top:19px}54%{width:0;left:1px;top:19px}70%{width:50px;left:-8px;top:37px}84%{width:17px;left:21px;top:48px}to{width:25px;left:14px;top:45px}}@-webkit-keyframes animate-success-long{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}@keyframes animate-success-long{0%{width:0;right:46px;top:54px}65%{width:0;right:46px;top:54px}84%{width:55px;right:0;top:35px}to{width:47px;right:8px;top:38px}}@-webkit-keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}@keyframes rotatePlaceholder{0%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}5%{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}12%{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}to{-webkit-transform:rotate(-405deg);transform:rotate(-405deg)}}.swal2-animate-success-line-tip{-webkit-animation:animate-success-tip .75s;animation:animate-success-tip .75s}.swal2-animate-success-line-long{-webkit-animation:animate-success-long .75s;animation:animate-success-long .75s}.swal2-success.swal2-animate-success-icon .swal2-success-circular-line-right{-webkit-animation:rotatePlaceholder 4.25s ease-in;animation:rotatePlaceholder 4.25s ease-in}@-webkit-keyframes animate-error-icon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}@keyframes animate-error-icon{0%{-webkit-transform:rotateX(100deg);transform:rotateX(100deg);opacity:0}to{-webkit-transform:rotateX(0deg);transform:rotateX(0deg);opacity:1}}.swal2-animate-error-icon{-webkit-animation:animate-error-icon .5s;animation:animate-error-icon .5s}@-webkit-keyframes animate-x-mark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}@keyframes animate-x-mark{0%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}50%{-webkit-transform:scale(.4);transform:scale(.4);margin-top:26px;opacity:0}80%{-webkit-transform:scale(1.15);transform:scale(1.15);margin-top:-6px}to{-webkit-transform:scale(1);transform:scale(1);margin-top:0;opacity:1}}.swal2-animate-x-mark{-webkit-animation:animate-x-mark .5s;animation:animate-x-mark .5s}@-webkit-keyframes rotate-loading{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate-loading{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}',\"\"])},function(e,t,n){t=e.exports=n(1)(),t.push([e.id,\"body,html{margin:0;height:100%;font-family:avenir}h1,h2,p{margin:0;padding:0}h1{padding:2% 0 0}h2{padding:0 0 2%;color:gray;font-size:75%;text-transform:uppercase;letter-spacing:2.5px}.game{display:flex;flex-direction:column;height:100%}.skip{position:absolute;bottom:0;right:0}#canvas-wrap{position:relative;flex:1;display:flex;overflow:hidden}#canvas{width:100%;flex:1;outline:none}#header{background:#333;justify-content:space-between}#header,#headerLeft{display:flex;align-items:center}#headerLeft{flex-direction:row;justify-content:center}#title{font-size:200%;font-weight:700;padding:7px 10px;margin-bottom:-10px}#title svg{display:block}#scoreboardButton{padding:0 10px;cursor:pointer}#scoreTable{max-height:300px;overflow:scroll}.chrome{background:#444;color:#ccc}.spacer{flex:1}.button{background:hsla(0,0%,100%,.13);cursor:pointer}#score-wrap,.button{padding:0 10px}#scoreInfo{display:flex}#username{border:0;background:#5c5c5c;outline:none;color:inherit;font-size:inherit;font-family:inherit;padding:0}.gold{color:#ff0}table tr:nth-child(2n) td{background-color:#d3d3d3}#path0_fill{fill:hsla(0,0%,100%,.8)}#end_button,#scoreboardButton{user-select:none}\",\"\"])},function(e,t,n){var a=n(8);\"string\"==typeof a&&(a=[[e.id,a,\"\"]]);n(2)(a,{});a.locals&&(e.exports=a.locals)},function(e,t,n){var a=n(9);\"string\"==typeof a&&(a=[[e.id,a,\"\"]]);n(2)(a,{});a.locals&&(e.exports=a.locals)}]);</script>";

uint8_t wifi_channel = 1;

void setup() {
  Serial.begin(115200);
  Serial.println("Booting");

  WiFi.mode(WIFI_AP);
  WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));

  //  WiFi.softAP("((PLAY BREAKOUT FOR FREE))", "", wifi_channel);
  WiFi.softAP("-> CLICK TO SET MESSAGE <-", "", wifi_channel);

  // if DNSServer is started with "*" for domain name, it will reply with
  // provided IP to all DNS request
  dnsServer.start(DNS_PORT, "*", apIP);
  SPIFFS.begin();


  File file = SPIFFS.open("messages.txt", "a+");
  while (file.available()) {
    String tmp = file.readStringUntil('\n');
    setSSID(tmp);
  }
  file.close();

  httpUpdater.setup(&webServer, update_path, update_username, update_password);

  webServer.on("/scores", HTTP_GET, []() {
    File file = SPIFFS.open("scores.txt", "r");
    webServer.streamFile(file, "application/json");
    file.close();
  });

  webServer.on("/scores", HTTP_POST, []() {
    String message = String(webServer.arg("data"));
    if (message.indexOf("\n") != -1) {
      webServer.send(500, "text/html", "Error: included forbidden characters");
      return;
    }
    File file = SPIFFS.open("scores.txt", "a+");
    file.println(message);
    file.close();
    webServer.send(200, "text/html", "SAVED SCORES");
  });

  webServer.on("/wallsmash", HTTP_GET, []() {
    webServer.send_P(200, "text/html", responseHTML);
  });



  webServer.on("/sign", HTTP_POST, []() {
    String message = String(webServer.arg("message"));
    message.trim();

    if (message.length() == 0) {
      webServer.send(200, "text/html", universal_preamble + "Message too short! You've gotta say something...");
      return;
    }

    if (message.length() > 240) {
      webServer.send(200, "text/html", universal_preamble + "Message too long! You can only post up to 240 characters.");
      return;
    }

    if (message == update_password) {
      SPIFFS.format();
      webServer.send(200, "text/html", universal_preamble + "Cleared all messages...");
      return;
    }

    if (message.indexOf("<") != -1 || message.indexOf(">") != -1 || message.indexOf("\n") != -1) {
      webServer.send(200, "text/html", universal_preamble + "Error: included forbidden characters");
      return;
    }

    File file = SPIFFS.open("messages.txt", "a+");
    file.println(message);
    file.close();

    setSSID(message);

    webServer.send(200, "text/html", universal_preamble + "<META http-equiv=\"refresh\" content=\"1;URL=/\">Posting message...\n");
  });



  webServer.on("/", HTTP_GET, []() {
    Serial.println("Serving");
    //    File file = SPIFFS.open("messages.txt", "a+");
    //    webServer.setContentLength(file.size() + preamble.length() + postamble.length());
    //    webServer.send(200, "text/html", preamble);
    //    webServer.client().write(file);
    //    file.close();
    //    webServer.sendContent(postamble);

    webServer.setContentLength(CONTENT_LENGTH_UNKNOWN);
    webServer.send(200, "text/html", preamble);
    File file = SPIFFS.open("messages.txt", "a+");
    while (file.available()) {
      String tmp = file.readStringUntil('\n');
      webServer.sendContent("<p>" + tmp + "</p>");
    }
    file.close();
    webServer.sendContent(postamble);
  });


  webServer.onNotFound([]() {
    webServer.sendHeader("Location", "http://3.141.59.26/");
    webServer.send(302, "text/html", universal_preamble + "Redirecting...");
  });
  webServer.begin();
  Serial.println("Ready");
}

extern "C" {
#include "user_interface.h"
  typedef void (*freedom_outside_cb_t)(uint8 status);
  int wifi_register_send_pkt_freedom_cb(freedom_outside_cb_t cb);
  void wifi_unregister_send_pkt_freedom_cb(void);
  int wifi_send_pkt_freedom(uint8 *buf, int len, bool sys_seq);
}


// beacon frame definition
uint8_t beaconPacket[109] = {
  /*  0 - 3  */ 0x80, 0x00, 0x00, 0x00, // Type/Subtype: managment beacon frame
  /*  4 - 9  */ 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, // Destination: broadcast
  /* 10 - 15 */ 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, // Source
  /* 16 - 21 */ 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, // Source

  // Fixed parameters
  /* 22 - 23 */ 0x00, 0x00, // Fragment & sequence number (will be done by the SDK)
  /* 24 - 31 */ 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00, // Timestamp
  /* 32 - 33 */ 0xe8, 0x03, // Interval: 0x64, 0x00 => every 100ms - 0xe8, 0x03 => every 1s
  /* 34 - 35 */ 0x31, 0x00, // capabilities Tnformation

  // Tagged parameters

  // SSID parameters
  /* 36 - 37 */ 0x00, 0x20, // Tag: Set SSID length, Tag length: 32
  /* 38 - 69 */ 0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20,
  0x20, 0x20, 0x20, 0x20, // SSID

  // Supported Rates
  /* 70 - 71 */ 0x01, 0x08, // Tag: Supported Rates, Tag length: 8
  /* 72 */ 0x82, // 1(B)
  /* 73 */ 0x84, // 2(B)
  /* 74 */ 0x8b, // 5.5(B)
  /* 75 */ 0x96, // 11(B)
  /* 76 */ 0x24, // 18
  /* 77 */ 0x30, // 24
  /* 78 */ 0x48, // 36
  /* 79 */ 0x6c, // 54

  // Current Channel
  /* 80 - 81 */ 0x03, 0x01, // Channel set, length
  /* 82 */      0x01,       // Current Channel

  // RSN information
  /*  83 -  84 */ 0x30, 0x18,
  /*  85 -  86 */ 0x01, 0x00,
  /*  87 -  90 */ 0x00, 0x0f, 0xac, 0x02,
  /*  91 -  92 */ 0x02, 0x00,
  /*  93 - 100 */ 0x00, 0x0f, 0xac, 0x04, 0x00, 0x0f, 0xac, 0x04, /*Fix: changed 0x02(TKIP) to 0x04(CCMP) is default. WPA2 with TKIP not supported by many devices*/
  /* 101 - 102 */ 0x01, 0x00,
  /* 103 - 106 */ 0x00, 0x0f, 0xac, 0x02,
  /* 107 - 108 */ 0x00, 0x00
};



void broadcastSSID() {
  uint32_t packetSize = 0;

  uint8_t macAddr[6];
  char emptySSID[32];

  beaconPacket[34] = 0x21;

  packetSize = sizeof(beaconPacket);
  if (wpa2) {
    beaconPacket[34] = 0x31;
  } else {
    beaconPacket[34] = 0x21;
    packetSize -= 26;
  }

  //  Return MAC address of soft access point.
  WiFi.softAPmacAddress(macAddr);

  // write MAC address into beacon frame
  memcpy(&beaconPacket[10], macAddr, 6);
  memcpy(&beaconPacket[16], macAddr, 6);

  // reset SSID
  memcpy(&beaconPacket[38], emptySSID, 32);

  const int ssidLen = test_ssid.length();

  // write new SSID into beacon frame
  memcpy(&beaconPacket[38], test_ssid.c_str(), ssidLen);

  // set channel for beacon frame
  beaconPacket[82] = wifi_channel;

  uint16_t tmpPacketSize = (packetSize - 32) + ssidLen; // calc size
  uint8_t* tmpPacket = new uint8_t[tmpPacketSize]; // create packet buffer
  memcpy(&tmpPacket[0], &beaconPacket[0], 38 + ssidLen); // copy first half of packet into buffer
  tmpPacket[37] = ssidLen; // update SSID length byte
  memcpy(&tmpPacket[38 + ssidLen], &beaconPacket[70], wpa2 ? 39 : 13); // copy second half of packet into buffer


  // send packet
  const int tries = 3;
  bool sent = wifi_send_pkt_freedom(tmpPacket, tmpPacketSize, 0) == 0;
  // try again until it's sent out
  for (int i = 0; i < tries && !sent; i++) {
    sent = wifi_send_pkt_freedom(tmpPacket, tmpPacketSize, 0) == 0;
    delay(1);
  }

  delete tmpPacket; // free memory of allocated buffer
}

void loop() {
  dnsServer.processNextRequest();
  webServer.handleClient();

  currentTime = millis();
  if (currentTime - packetRateTime > 100) {
    packetRateTime = currentTime;
    broadcastSSID();
  }
}
